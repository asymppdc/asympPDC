
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>PDC or DTF analysis getting started template file</title><meta name="generator" content="MATLAB 9.8"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2022-08-02"><meta name="DC.source" content="analysis_template.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>PDC or DTF analysis getting started template file</h1><!--introduction--><p>Follow and edit this template to set up analysis or  your data. You might want to choose analysis parameters followed by comment containing "&lt;***&gt;". Check bellow.</p><p>Some important input and output parameters and variables: input:        u     - time series data  in row-wise orientation        fs    - Sampling frequency (=1 for normalized frequency)        maxIP - externally defined maximum IP        alg   - for algorithm (1: Nutall-Strand),(2: mlsm) ,                              (3: Vieira Morf),  (4: ARfit)        criterion - for AR order selection =&gt;                                   1: AIC; 2: Hanna-Quinn; 3: Schwarz;                                   4: FPE, 5: fixed order in MaxIP        alpha  -  PDC test significance level</p><p>output: c struct variable from asymp_pdc() or asymp_dtf() function         required fields:         c.{pdc2, dtf2} - squared original/generalized/information PDC         c.th -  threshold level by Patnaik approximation         c.{pdc_th,dtf_th} - above threshold pdc2 or dtf2 values otherwise equal NaN         c.ci1,c.ci2 - superior and inferior confidence interval         c.p - VAR model order         c.SS - Power spectrum         c.coh2 - coherece function</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">asympPDC analysis functions</a></li><li><a href="#3">Examples</a></li><li><a href="#5">Selecting Data Pre-processing Action flags</a></li><li><a href="#6">Set up Multivariate AutoRegressive (MAR) estimation algorithm parameters</a></li><li><a href="#10">PDC or DTF Analysis parameters</a></li><li><a href="#14">Pretty-plot option parameters for xplot and xplot_pvalues function</a></li><li><a href="#15">Adding further analysis details to the figure title.</a></li></ul></div><h2 id="1">asympPDC analysis functions</h2><pre>See also  mvar, mvarresidue, asymp_pdc, asymp_dtf, gct_alg, igct_alg,
          xplot, xplot_pvalues, xplot_title</pre><pre class="codeinput"><span class="comment">%===========================#</span>
<span class="comment">% Times series for analysis /</span>
<span class="comment">%===========================#</span>
<span class="comment">% u     - time series data in rows.</span>
<span class="comment">%         The variable u must contain the time series</span>
<span class="comment">%         In this template, if flgExample = 1 the template file will analyze a</span>
<span class="comment">%         5-variable Gaussian independent noise processes.</span>

format <span class="string">compact</span>
clear <span class="string">all</span>; clc
</pre><h2 id="3">Examples</h2><pre class="codeinput"><span class="comment">% Choose Example 1 == Five independent Gaussian random variables model</span>
<span class="comment">%                2 == Sunspot-melanoma time series</span>
<span class="comment">%                3 == Baccala &amp; Sameshima (2001) 5-variable linear model</span>
<span class="comment">%                4 == Takahashi(2008) Thesis' example model</span>
flgExample = 3;

disp(<span class="string">'======================================================================'</span>);
disp(<span class="string">'============= PDC analysis getting started template =================='</span>)
disp(<span class="string">'======================================================================'</span>);

<span class="keyword">switch</span> flgExample
   <span class="keyword">case</span> 1
      u=randn(2000,5);    <span class="comment">%&lt;***&gt; Example (1)</span>
      disp(<span class="string">'            Random Independent Process with 5 variables'</span>)
      disp(<span class="string">'======================================================================'</span>);

   <span class="keyword">case</span> 2
      u=sunmeladat([4 3]); <span class="comment">%&lt;***&gt; Example (2)</span>
      disp(<span class="string">'     Andrews and Herzberg''s Sunspot and Melanoma Example'</span>);
      disp(<span class="string">'                 Sunspot --&gt; Melanoma or other way?'</span>);
      disp(<span class="string">'======================================================================'</span>);
   <span class="keyword">case</span> 3
      u=baccala2001a_ex5data(2000);
   <span class="keyword">case</span> 4
      u=takahashi_thesis_dat(200);
   <span class="keyword">otherwise</span>
      error(<span class="string">'Wrong example selection.'</span>)
<span class="keyword">end</span>

fs = 1; <span class="comment">%&lt;***&gt; Sampling frequency</span>
</pre><pre class="codeoutput">======================================================================
============= PDC analysis getting started template ==================
======================================================================
======================================================================
             Linear VAR(2) Model Example 5 - closed-loop
         Baccala &amp; Sameshima. Biol. Cybern. 84:463-474, 2001.
           x1==&gt;x2  x2--&gt;x3 x3--&gt;x4 x4--&gt;x5 x5--&gt;x4 x5--&gt;x1
======================================================================
</pre><p>Checking structure of input time series u</p><pre class="codeinput">[nChannels,nSegLength] =size(u);
<span class="keyword">if</span> nChannels &gt; nSegLength
   disp(<span class="string">'The data might be transposed.'</span>);
   u = u.';
   [nChannels,nSegLength]=size(u);
<span class="keyword">end</span>

<span class="comment">%===========================#</span>
<span class="comment">%  Channel identification   /</span>
<span class="comment">%===========================#</span>

<span class="keyword">switch</span> flgExample
  <span class="keyword">case</span> 1
    chLabels  = {<span class="string">'x_1'</span>;<span class="string">'x_2'</span>;<span class="string">'x_3'</span>;<span class="string">'x_4'</span>;<span class="string">'x_5'</span>}; <span class="comment">%&lt;***&gt; Example (1)</span>
    strTitle2 = <span class="string">'Five independent Gaussian noises '</span>; <span class="comment">%Title info</span>
  <span class="keyword">case</span> 2
    chLabels  = {<span class="string">'Sunspot'</span>;<span class="string">'Melanoma'</span>}; <span class="comment">%&lt;***&gt; Example (2)</span>
    strTitle2 = <span class="string">'Sunspot-Melanoma 1936-1972 '</span>;
  <span class="keyword">case</span> 3
    chLabels  = [];                     <span class="comment">%&lt;***&gt; Example (3)</span>
    strTitle2 = <span class="string">'Five-variable example '</span>;
  <span class="keyword">case</span> 4
    chLabels  = {<span class="string">'X'</span>; <span class="string">'Y'</span>; <span class="string">'Z'</span>};        <span class="comment">% Takahashi's thesis example</span>
    strTitle2 = <span class="string">'Takahashi 2008 (Thesis) example'</span>;
<span class="keyword">end</span>

flgLabels = ~isempty(chLabels);
<span class="keyword">if</span> flgLabels
  <span class="keyword">if</span> nChannels ~= max(size(chLabels))
    error(<span class="string">'Numbers of labels and channels do not match.'</span>)
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><pre class="codeoutput">The data might be transposed.
</pre><h2 id="5">Selecting Data Pre-processing Action flags</h2><pre class="codeinput">flgDetrend = 1;     <span class="comment">%&lt;***&gt; Usually it's recommended to detrend the time series.</span>

flgStandardize = 0; <span class="comment">%&lt;***&gt; For gPDC and iPDC estimates normalization has no effect.</span>
<span class="keyword">if</span> flgStandardize
  disp(<span class="string">'Be aware that the data standardization does not affect the generalized'</span>)
  disp(<span class="string">'   and information PDC/DTF estimates nor its statistical results, '</span>)
  disp(<span class="string">'   so that data standardization is not necessary in these measures.'</span>)
<span class="keyword">end</span>
</pre><h2 id="6">Set up Multivariate AutoRegressive (MAR) estimation algorithm parameters</h2><p>Choose one of algorithm for MAR model estimation alg - for algorithm (1: Nutall-Strand),(2: mlsm minimum least-square method),                     (3: Vieira Morf),  (4: QR artfit)</p><pre class="codeinput">alg = 1; <span class="comment">%&lt;***&gt; Nuttall-Strand (alg=1) algorithm, our experience indicate that</span>
         <span class="comment">%      N-S seems to be a good and robust estimation algorithm.</span>
</pre><p>MAR model order selection criteria</p><p>criterion - for AR order choice  1: AIC; 2: Hanna-Quinn; 3: Schwarz or BIC;  4: FPE, 5: fixed MAR order given by MaxIP bellow</p><pre class="codeinput">criterion = 1; <span class="comment">%&lt;***&gt; AIC, Akaike information criterion (Our preferred one</span>
               <span class="comment">%      along with BIC)</span>

maxIP = 30; <span class="comment">% maxIP - externally defined maximum IP %&lt;***&gt;</span>
</pre><p>Adequacy of MAR model estimate</p><pre class="codeinput">VARadequacy_signif = 0.05; <span class="comment">% VAR model adequacy significance level</span>
</pre><h2 id="10">PDC or DTF Analysis parameters</h2><p>Selecting number of frequency points</p><pre class="codeinput">nFreqs = 128; <span class="comment">%&lt;***&gt; number of points on frequency scale;</span>
              <span class="comment">%      recommended to use either 64 or 128.</span>
</pre><p>Selection of metric used in PDC or DTF estimate</p><pre class="codeinput">metric = <span class="string">'info'</span>;
<span class="comment">%        metric   'euc'  - Euclidean     -&gt; original PDC or DTF;</span>
<span class="comment">%                 'diag' - diagonal      -&gt; gPDC or DC;</span>
<span class="comment">%                 'info' - information   -&gt; iPDC or DTF;</span>
</pre><p>Significance level for PDC2 null hypothesis testing, GCT and iGCT</p><pre class="codeinput">alpha = 0.01;        <span class="comment">%&lt;***&gt; Significance level for PDC2 null hypothesis testing,</span>
                     <span class="comment">%</span>
                     <span class="comment">% Note: if alpha == 0, no asymptotic statistics</span>
                     <span class="comment">% calculation is performed and ASYMP_PDC (see bellow)</span>
                     <span class="comment">% will only returns PDC. This option is interesting</span>
                     <span class="comment">% if you want faster PDC calculation.</span>

gct_signif = alpha;  <span class="comment">% Granger causality test significance. Choose other</span>
                     <span class="comment">% value if you have good reason for adopting different</span>
                     <span class="comment">% one from frequency domain statistical testing.</span>

igct_signif = alpha; <span class="comment">% Instantaneous Granger causality test significance level.</span>
</pre><h2 id="14">Pretty-plot option parameters for xplot and xplot_pvalues function</h2><pre class="codeinput">flgScale = 2; <span class="comment">% 1: [0 1] / {if max(PDC2/DTF2) &gt; 1}:[0 max(PDC2/DTF2)]</span>
<span class="comment">%               2: [0 {if max(PDC/DTF2) &gt; 1}:max(PDC/DTF2)]/[0 1]/[0 .1]/[0 .01]</span>
<span class="comment">%                                         based on flgMax (PDC2/DTF2/Thr/CI/all)</span>
<span class="comment">%               3: [0 max(PDC2/DTF2/Thr/CI/all)]</span>
<span class="comment">%                                         based on flgMax (PDC2/DTF2/Thr/CI/all)</span>
<span class="comment">%               4: [0 {max(PDC2/DTF2/Thr/CI/all) or round to {0.01 0.1 1.0}]</span>

flgMax = <span class="string">'all'</span>; <span class="comment">% {'PDC'|'DTF'|'Thr'|'CI'|'TCI'|'all'} measure used as upper limit</span>
<span class="comment">%                for y-axis scales:</span>
<span class="comment">%                    PDC|DTF - PDC2/DTF2 maximum value;</span>
<span class="comment">%                        Thr - Patnaik threshold maximum value;</span>
<span class="comment">%                        CI  - maximum upper confidence interval value;</span>
<span class="comment">%                        TCI - threshold or CI max value;</span>
<span class="comment">%                        all - plotted either max([PDC2/DTF2, Thr, CI]) value;</span>
<span class="comment">%               See also flgScale.</span>

flgSignifColor = 3; <span class="comment">% 0: black line</span>
                    <span class="comment">% 1: black / gray -&gt; significant /not signif PDC/DTF</span>
                    <span class="comment">% 2: red  /  gray -&gt;      "</span>
                    <span class="comment">% 3: red  / green -&gt;      "</span>
                    <span class="comment">% 4: red  / black -&gt;      "</span>
                    <span class="comment">% 5: black / green</span>

flgColor = [0 1]; <span class="comment">% Plotting option for automatic scaling for small PDC</span>
                  <span class="comment">% values.</span>
                  <span class="comment">% if flgColor = 0, y-axis scale = [0 1]</span>
                  <span class="comment">% elseif flgColor = 1, the pdc_xplot routine rescales</span>
                  <span class="comment">% the y-axis automatically according to the following</span>
                  <span class="comment">% rules:</span>
                  <span class="comment">%   if .01&lt;=PDC(f) &lt; .1 background-color = light-blue,</span>
                  <span class="comment">%                          so that y-axis scale = [0 .1]</span>
                  <span class="comment">%   elseif PDC(f) &lt; .01 background-color = light-purple</span>
                  <span class="comment">%                          and y-axis = [0 .01];</span>
                  <span class="comment">% for flgColor=[0 1], both lay-outs are plotted.</span>


<span class="comment">%                 1 2 3 4 5 6 7</span>
flgPrinting   =  [1 1 1 2 2 0 1]; <span class="comment">% Example: Plot everything, except coh2.</span>
<span class="comment">%           blue  | | | | | | 7-- {0:5} Spectra (0: w/o; 1: Linear; 2: Log;</span>
<span class="comment">%                 | | | | | |           3: PDC2; 4: Linear normalized;</span>
<span class="comment">%                 | | | | | |           5: Log spectra + PDC2)</span>
<span class="comment">%           gray  | | | | | 6-- {0:1} Coh2 (0: w/o Coh2; 1: w Coh2)</span>
<span class="comment">%    dark-purple  | | | | 5-- {0:3} Print GCT p-values and dot-mark significant</span>
<span class="comment">%  or dark-green  | | | |           connectivity channel-pair (0: w/o;</span>
<span class="comment">%                 | | | |           1: p-values; 2: dot-mark +GCT;</span>
<span class="comment">%                 | | | |           3: p-values + dot-mark significant GCT)</span>
<span class="comment">%    dashed-blue  | | | 4-- {0:4} Confidence interval (0:w/o; 1: Dashed-lines;</span>
<span class="comment">%                 | | |           2: Shaded-plot; 3: Error-bar 1; 4: Error-bar 2</span>
<span class="comment">%            red  | | 3-- {0:1} Significant PDC2|DTF2 in red lines</span>
<span class="comment">%   dashed-black  | 2-- {0:1} Patnaik threshold level in black dashed-lines</span>
<span class="comment">%          green  1-- {0:1} PDC2/DTF2 in green lines or black w/o statistics,</span>
<span class="comment">%                           see flgSignifColor bellow for line color selection.</span>

w = fs*(0:(nFreqs-1))/2/nFreqs; <span class="comment">% frequency scale</span>

<span class="comment">% maximum frequency to plot in frequency domain measures</span>
w_max = fs/2; <span class="comment">%&lt;***&gt; Usually half of sampling frequency, the Nyquist frequency</span>


<span class="comment">%==========================================================================</span>
<span class="comment">%==========================================================================</span>
<span class="comment">%        WARNING: BELOW THIS LINE PROBABLY YOU MIGHT NOT WANT TO EDIT,</span>
<span class="comment">%            UNLESS YOU NEED TO CUSTOMIZE YOUR ANALYSIS ROUTINE.</span>
<span class="comment">%==========================================================================</span>

<span class="comment">%==========================================================================</span>
<span class="comment">%                    Detrend and standardization options</span>
<span class="comment">%==========================================================================</span>


<span class="comment">% Determine time series length and check if data is row-wise organized.</span>
[nChannels,nSegLength]=size(u);
<span class="keyword">if</span> nChannels &gt; nSegLength, u=u.';
   [nChannels,nSegLength]=size(u); <span class="comment">% Transpose if not.</span>
<span class="keyword">end</span>

<span class="keyword">if</span> flgDetrend
   <span class="keyword">for</span> i=1:nChannels, u(i,:)=detrend(u(i,:)); <span class="keyword">end</span>
   disp(<span class="string">'Time series were detrended.'</span>);
<span class="keyword">end</span>

<span class="keyword">if</span> flgStandardize
   <span class="keyword">for</span> i=1:nChannels, u(i,:)=u(i,:)/std(u(i,:)); <span class="keyword">end</span>
   disp(<span class="string">'Time series were scale-standardized.'</span>);
<span class="keyword">end</span>



<span class="comment">%==========================================================================</span>
<span class="comment">% Additional info for title (optional)</span>

strTitle1 = [];

<span class="comment">%==================</span>
<span class="keyword">switch</span> alg
  <span class="keyword">case</span> 1
    disp(<span class="string">'VAR estimation using Nutall-Strand algorithm.'</span>)
  <span class="keyword">case</span> 2
    disp(<span class="string">'VAR estimation using least-squares estimator.'</span>)
  <span class="keyword">case</span> 3
    disp(<span class="string">'VAR estimation using Vieira-Morf algorithm.'</span>)
  <span class="keyword">case</span> 4
    disp(<span class="string">'VAR estimation using QR-Arfit algorithm.'</span>)
<span class="keyword">end</span>

<span class="comment">%================================#</span>
<span class="comment">%   MAR order selection criteria /</span>
<span class="comment">%================================#</span>
<span class="keyword">switch</span> criterion
   <span class="keyword">case</span> 1
      disp(<span class="string">'Model order selection criteria: AIC.'</span>)
   <span class="keyword">case</span> 2
      disp(<span class="string">'Model order selection criteria: Hanna-Quinn.'</span>)
   <span class="keyword">case</span> 3
      disp(<span class="string">'Model order selection criteria: Schwarz (BIC).'</span>)
   <span class="keyword">case</span> 4
      disp(<span class="string">'Model order selection criteria: FPE.'</span>)
   <span class="keyword">case</span> 5
      disp(<span class="string">'Model order selection criteria: fixed order in maxIP.'</span>)
   <span class="keyword">otherwise</span>
      error(<span class="string">'Model order selection criteria: NOT IMPLEMENTED YET.'</span>)
<span class="keyword">end</span>

<span class="comment">%==========================================================================</span>
<span class="comment">%    VAR model estimation</span>
<span class="comment">%==========================================================================</span>
[IP,pf,A,pb,B,ef,eb,vaic,Vaicv] = mvar(u,maxIP,alg,criterion);

disp([<span class="string">'Number of channels = '</span> int2str(nChannels) <span class="string">' with '</span> <span class="keyword">...</span>
       int2str(nSegLength) <span class="string">' data points; MAR model order = '</span> int2str(IP) <span class="string">'.'</span>]);

<span class="comment">%==========================================================================</span>
<span class="comment">%    Testing for adequacy of MAR model fitting through Portmanteau test</span>
<span class="comment">%==========================================================================</span>
h = 20; <span class="comment">% testing lag</span>
aValueVAR = 1 - VARadequacy_signif;
flgPrintResults = 1;
[Pass,Portmanteau,st,ths] = mvarresidue(ef,nSegLength,IP,aValueVAR,h,<span class="keyword">...</span>
                                                          flgPrintResults);

<span class="comment">%==========================================================================</span>
<span class="comment">%         Granger causality test (GCT)</span>
<span class="comment">%==========================================================================</span>
flgPrintResults = 1;
[Tr_gct, pValue_gct] = gct_alg(u,A,pf,gct_signif,flgPrintResults);

<span class="comment">%==========================================================================</span>
<span class="comment">%         Instantaneous Granger causality test (iGCT)</span>
<span class="comment">%==========================================================================</span>
flgPrintResults = 1;
[Tr_igct, pValue_igct] = igct_alg(u,A,pf,gct_signif,flgPrintResults);

<span class="comment">%==========================================================================</span>
<span class="comment">%            PDC, threshold and confidence interval calculation.</span>
<span class="comment">%==========================================================================</span>

<span class="comment">% if alpha == 0, no asymptotic statistics is performed. ASYMP_PDC returns</span>
<span class="comment">% only the PDC. This option is much faster!!</span>

c = asymp_pdc(u,A,pf,nFreqs,metric,alpha);

<span class="comment">% If you want to print the Granger Causality Test p-values you need to</span>
<span class="comment">% assign these values to c struct variable</span>
c.Tragct = Tr_gct;
c.pvaluesgct = pValue_gct;

<span class="comment">%                    or</span>
<span class="comment">% c=asymp_dtf(u,A,pf,nFreqs,metric,alpha); % for DTF analysis</span>
</pre><pre class="codeoutput">Time series were detrended.
VAR estimation using Nutall-Strand algorithm.
Model order selection criteria: AIC.
maxOrder limited to 30
IP=1  vaic=78725.409631
IP=2  vaic=75978.042250
IP=3  vaic=75997.884324
 
Number of channels = 5 with 2000 data points; MAR model order = 2.

====================================================================================================
                  MVAR RESIDURES TEST FOR WHITENESS
----------------------------------------------------------------------------------------------------
Good MAR model fitting! Residues white noise hypothesis NOT rejected.
Pass = 0.038
  st = 437.506

====================================================================================================
                         GRANGER CAUSALITY TEST
----------------------------------------------------------------------------------------------------
Connectivity matrix:
   NaN     0     0     0     1
     1   NaN     0     0     0
     0     1   NaN     0     0
     0     0     1   NaN     1
     0     0     0     1   NaN

Granger causality test p-values:
       NaN    0.9872    0.2843    0.9463         0
         0       NaN    0.7038    0.8642    0.1038
    0.3861         0       NaN    0.2397    0.0897
    0.0118    0.0547         0       NaN         0
    0.7792    0.5140    0.1410         0       NaN

====================================================================================================
                  INSTANTANEOUS GRANGER CAUSALITY TEST
----------------------------------------------------------------------------------------------------
Instantaneous connectivity matrix:
   NaN     0     0     0     0
     0   NaN     0     0     0
     0     0   NaN     0     0
     0     0     0   NaN     0
     0     0     0     0   NaN

Instantaneous Granger Causality test p-values:
       NaN    0.8649    0.7968    0.4173    0.1674
    0.8649       NaN    0.2890    0.1162    0.2779
    0.7968    0.2890       NaN    0.2748    0.7064
    0.4173    0.1162    0.2748       NaN    0.2408
    0.1674    0.2779    0.7064    0.2408       NaN

&gt;&gt;&gt;&gt; Instantaneous Granger Causality NOT detected.

====================================================================================================
</pre><h2 id="15">Adding further analysis details to the figure title.</h2><pre class="codeinput"><span class="comment">% strTitle3 = ['[N=' int2str(nSegLength) 'pts; IP=' int2str(c.p) '; ' ...</span>
<span class="comment">%    datestr(now) ']'];</span>
strTitle3 = [<span class="string">'[N='</span> int2str(nSegLength) <span class="string">'pts; IP='</span> int2str(c.p) <span class="string">']'</span>];

<span class="comment">% or leave it empty: strTitle3=[];</span>

<span class="comment">%==========================================================================</span>
<span class="comment">%              Matrix Layout Plotting of the Analysis Results</span>
<span class="comment">%==========================================================================</span>

w_max = fs/2;
strTitle = [strTitle1 strTitle2 strTitle3];
strWindowName = <span class="string">'PDC/DTF/GCT Analysis Template Example'</span>;

<span class="comment">% The following "for loop" through flgColor values, 0 and 1, and yields a</span>
<span class="comment">% pair of plots, one without and other with color scale rearrangement option.</span>
<span class="comment">% Value range of PDC and Coherence is from [0 1], but sometimes the maximum</span>
<span class="comment">% peak value is small (&lt;0.1), or even smaller, (&lt;.01), so in these cases it</span>
<span class="comment">% might be interesting to have a plot with finer smaller y-axis scale. The</span>
<span class="comment">% white-background plot indicates full-scale [0 1] y-axis, while</span>
<span class="comment">% light-blue-background stands for intermediate [0 .1] scaling and</span>
<span class="comment">% light-purple-background shows very fine detail of small, usually not</span>
<span class="comment">% significant PDCs. Try flgColor = 0 or 1, or both [0 1].</span>

flgColor = [0 1];

<span class="keyword">for</span> kflgColor = flgColor
   <span class="keyword">if</span> kflgColor
       strWindowName = <span class="string">'xplot FUNCTION **WITH** background scale color.'</span>;
   <span class="keyword">else</span>
       strWindowName = <span class="string">'xplot FUNCTION **WITHOUT** background scale color.'</span>;
   <span class="keyword">end</span>

   flgPrinting   =  [1 1 1 2 0 0 1];
   <span class="comment">%           blue  | | | | | | 7-- {1} Spectra 1: Linear scale</span>
   <span class="comment">%           gray  | | | | | 6-- {0} Without Coh2</span>
   <span class="comment">%    dark-purple  | | | | 5-- {0} GCT 0: without</span>
   <span class="comment">%    dashed-blue  | | | 4-- {2} Confidence interval 2: Shaded-plot</span>
   <span class="comment">%            red  | | 3-- {1} Significant PDC2|DTF2 in red lines</span>
   <span class="comment">%   dashed-black  | 2-- {1} Patnaik threshold level in black dashed-lines</span>
   <span class="comment">%          green  1-- {1} PDC2 in green lines or black w/o statistics,</span>

   [h2,~,~] = xplot(strWindowName,c,flgPrinting,fs,w_max,chLabels, <span class="keyword">...</span>
                                 kflgColor,flgScale,flgMax,flgSignifColor);
   xplot_title(alpha,metric,<span class="string">'pdc'</span>,strTitle);
   pause(3)

   flgPrinting   =  [1 1 1 2 3 0 0];
   <span class="comment">%           blue  | | | | | | 7-- {0} No plotting on main diagonal</span>
   <span class="comment">%           gray  | | | | | 6-- {0} Without Coh2</span>
   <span class="comment">%    dark-purple  | | | | 5-- {3} Print GCT 3: p-values + dot-mark significant GCT</span>
   <span class="comment">%    dashed-blue  | | | 4-- {4} Confidence interval 2: Shaded-plot</span>
   <span class="comment">%            red  | | 3-- {1} Significant PDC2|DTF2 in red lines</span>
   <span class="comment">%   dashed-black  | 2-- {1} Patnaik threshold level in black dashed-lines</span>
   <span class="comment">%          green  1-- {1} PDC2 in green lines or black w/o statistics,</span>

    [h2,~,~] = xplot(strWindowName,c,flgPrinting,fs,w_max,chLabels, <span class="keyword">...</span>
                                 kflgColor,flgScale,flgMax,flgSignifColor);
   xplot_title(alpha,metric,<span class="string">'pdc'</span>,strTitle);
   pause(3) <span class="comment">% Pause to allow figure visualization during analysis</span>

<span class="keyword">end</span>

<span class="comment">%==========================================================================</span>
<span class="comment">%              Matrix Layout Plotting of PDC p-values</span>
<span class="comment">%==========================================================================</span>
<span class="comment">% See xplot_p-values() function for more details</span>
<span class="comment">%</span>
<span class="comment">%   flgPrinting: [1 1 1 2 3 0 0];</span>
<span class="comment">%           blue  | | | | | | 7-- {0:2} Spectra (0: wo; 1: Linear; 2: Log)</span>
<span class="comment">%                 | | | | | 6-- {} Not used</span>
<span class="comment">%   dark-purple   | | | | 5-- {0:3} Mark significant GCT pairs + print p-values</span>
<span class="comment">%  or dark-green  | | | |          (0: w/o; 1: print p-values; 2: mark +GCT;</span>
<span class="comment">%                 | | | |           3: print p-values + mark significant GCT)</span>
<span class="comment">%    dashed-blue  | | | 4-- {0:2} Scale of p-values plots 1:linear; 2:log10</span>
<span class="comment">%                 | | 3-- {} Not used</span>
<span class="comment">%   dashed-black  | 2-- {0:1} Patnaik threshold level in black dashed-line</span>
<span class="comment">%                 1-- {} Not used</span>

flgPrinting  =   [1 1 1 2 3 0 0];
flgScale = 2; <span class="comment">% y-axis scale for p-values: 1: linear [0 1] and log [0 -15];</span>
<span class="comment">%                                          2: log y-axis according to</span>
<span class="comment">%                                             max(abs(pvalues_log10)) value</span>
<span class="comment">%                                             [0 -5], [0 -10] or [0 -15]</span>
strWindow = [<span class="string">'xplot_p-values FUNCTION to plot PDC p-values in frequency domain'</span>];

[h3,~,~] = xplot_pvalues(strWindow,c,flgPrinting,fs,w_max,chLabels, <span class="keyword">...</span>
                                     flgColor,flgScale);
xplot_title(alpha,metric,strTitle)


<span class="comment">%======================= xplot ========================================</span>
<span class="comment">%Plot legend:  Blue lines on the main diagonal = Power spectra;</span>
<span class="comment">%              Black dashed lines are Patnaik threshold for dtfn;</span>
<span class="comment">%              Green lines = non significant dtfn;</span>
<span class="comment">%              Red lines = significant dtfn;</span>
<span class="comment">%              Light-gray lines = coherence function.</span>
<span class="comment">%</span>
<span class="comment">% Notes:       a.The main diagonal of matrix layout contains power spectra.</span>
<span class="comment">%              b.Coherences are symmetric, e.g.,</span>
<span class="comment">%                   Coh_{Sunspot,Melanoma}(f) = Coh_{Melanoma,Sunspot}(f).</span>
<span class="comment">%              c.dtfn is asymmetric relation, and the dtfn graphics should</span>
<span class="comment">%              be read as if the flow of information is been from the</span>
<span class="comment">%              x-axis variable toward y-axis variable.</span>
<span class="comment">%</span>
<span class="comment">%              For sunspot and melanoma example, one only sees significant</span>
<span class="comment">%              dtfn from Sunspot to Melanoma, which could eventually be</span>
<span class="comment">%              interpreted that "Sunspot", or the Sun's activity</span>
<span class="comment">%              modulates the incidence of melanoma.</span>
<span class="comment">%======================= dtf_xplot ========================================</span>
disp(<span class="string">'======================================================================'</span>);
disp(<span class="string">'============ ANALYSIS_TEMPLATE SUCCESSFULLY FINISHED ================='</span>)
disp(<span class="string">'======================================================================'</span>);
</pre><pre class="codeoutput">======================================================================
============ ANALYSIS_TEMPLATE SUCCESSFULLY FINISHED =================
======================================================================
</pre><img vspace="5" hspace="5" src="analysis_template_01.png" alt=""> <img vspace="5" hspace="5" src="analysis_template_02.png" alt=""> <img vspace="5" hspace="5" src="analysis_template_03.png" alt=""> <img vspace="5" hspace="5" src="analysis_template_04.png" alt=""> <img vspace="5" hspace="5" src="analysis_template_05.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% PDC or DTF analysis getting started template file
%
% Follow and edit this template to set up analysis or  your data. You might
% want to choose analysis parameters followed by comment containing
% "<***>". Check bellow.
%
% Some important input and output parameters and variables:
% input:
%        u     - time series data  in row-wise orientation
%        fs    - Sampling frequency (=1 for normalized frequency)
%        maxIP - externally defined maximum IP
%        alg   - for algorithm (1: Nutall-Strand),(2: mlsm) ,
%                              (3: Vieira Morf),  (4: ARfit)
%        criterion - for AR order selection =>
%                                   1: AIC; 2: Hanna-Quinn; 3: Schwarz;
%                                   4: FPE, 5: fixed order in MaxIP
%        alpha  -  PDC test significance level
%
% output: c struct variable from asymp_pdc() or asymp_dtf() function
%         required fields:
%         c.{pdc2, dtf2} - squared original/generalized/information PDC
%         c.th -  threshold level by Patnaik approximation
%         c.{pdc_th,dtf_th} - above threshold pdc2 or dtf2 values otherwise equal NaN
%         c.ci1,c.ci2 - superior and inferior confidence interval
%         c.p - VAR model order
%         c.SS - Power spectrum
%         c.coh2 - coherece function
%
%% asympPDC analysis functions 
%  See also  mvar, mvarresidue, asymp_pdc, asymp_dtf, gct_alg, igct_alg, 
%            xplot, xplot_pvalues, xplot_title
%
%%


%===========================#
% Times series for analysis /
%===========================#
% u     - time series data in rows.
%         The variable u must contain the time series
%         In this template, if flgExample = 1 the template file will analyze a
%         5-variable Gaussian independent noise processes.

format compact
clear all; clc

%% Examples 

% Choose Example 1 == Five independent Gaussian random variables model
%                2 == Sunspot-melanoma time series
%                3 == Baccala & Sameshima (2001) 5-variable linear model
%                4 == Takahashi(2008) Thesis' example model                
flgExample = 3;

disp('======================================================================');
disp('============= PDC analysis getting started template ==================')
disp('======================================================================');

switch flgExample
   case 1
      u=randn(2000,5);    %<***> Example (1)
      disp('            Random Independent Process with 5 variables')
      disp('======================================================================');

   case 2
      u=sunmeladat([4 3]); %<***> Example (2)
      disp('     Andrews and Herzberg''s Sunspot and Melanoma Example');
      disp('                 Sunspot REPLACE_WITH_DASH_DASH> Melanoma or other way?');
      disp('======================================================================');
   case 3
      u=baccala2001a_ex5data(2000);
   case 4
      u=takahashi_thesis_dat(200);
   otherwise
      error('Wrong example selection.')
end

fs = 1; %<***> Sampling frequency

%%
% Checking structure of input time series u
[nChannels,nSegLength] =size(u);
if nChannels > nSegLength
   disp('The data might be transposed.');  
   u = u.';
   [nChannels,nSegLength]=size(u);
end

%===========================#
%  Channel identification   /
%===========================#

switch flgExample
  case 1
    chLabels  = {'x_1';'x_2';'x_3';'x_4';'x_5'}; %<***> Example (1)
    strTitle2 = 'Five independent Gaussian noises '; %Title info
  case 2
    chLabels  = {'Sunspot';'Melanoma'}; %<***> Example (2)
    strTitle2 = 'Sunspot-Melanoma 1936-1972 ';
  case 3
    chLabels  = [];                     %<***> Example (3)
    strTitle2 = 'Five-variable example ';
  case 4
    chLabels  = {'X'; 'Y'; 'Z'};        % Takahashi's thesis example
    strTitle2 = 'Takahashi 2008 (Thesis) example';
end

flgLabels = ~isempty(chLabels);
if flgLabels
  if nChannels ~= max(size(chLabels))
    error('Numbers of labels and channels do not match.')
  end
end

%% Selecting Data Pre-processing Action flags
%

flgDetrend = 1;     %<***> Usually it's recommended to detrend the time series.

flgStandardize = 0; %<***> For gPDC and iPDC estimates normalization has no effect.
if flgStandardize
  disp('Be aware that the data standardization does not affect the generalized')
  disp('   and information PDC/DTF estimates nor its statistical results, ')
  disp('   so that data standardization is not necessary in these measures.')
end


%% Set up Multivariate AutoRegressive (MAR) estimation algorithm parameters
%

%%
% Choose one of algorithm for MAR model estimation
% alg - for algorithm (1: Nutall-Strand),(2: mlsm minimum least-square
% method),
%                     (3: Vieira Morf),  (4: QR artfit)

alg = 1; %<***> Nuttall-Strand (alg=1) algorithm, our experience indicate that
         %      N-S seems to be a good and robust estimation algorithm.

%% 
% MAR model order selection criteria
%
% criterion - for AR order choice
%  1: AIC; 2: Hanna-Quinn; 3: Schwarz or BIC;
%  4: FPE, 5: fixed MAR order given by MaxIP bellow

criterion = 1; %<***> AIC, Akaike information criterion (Our preferred one 
               %      along with BIC)

maxIP = 30; % maxIP - externally defined maximum IP %<***>

%%
% Adequacy of MAR model estimate

VARadequacy_signif = 0.05; % VAR model adequacy significance level


%% PDC or DTF Analysis parameters
%

%%
% Selecting number of frequency points

nFreqs = 128; %<***> number of points on frequency scale; 
              %      recommended to use either 64 or 128.
%%
% Selection of metric used in PDC or DTF estimate

metric = 'info';
%        metric   'euc'  - Euclidean     -> original PDC or DTF;
%                 'diag' - diagonal      -> gPDC or DC;
%                 'info' - information   -> iPDC or DTF;

%%
% Significance level for PDC2 null hypothesis testing, GCT and iGCT 

alpha = 0.01;        %<***> Significance level for PDC2 null hypothesis testing,
                     %
                     % Note: if alpha == 0, no asymptotic statistics 
                     % calculation is performed and ASYMP_PDC (see bellow) 
                     % will only returns PDC. This option is interesting 
                     % if you want faster PDC calculation.
                     
gct_signif = alpha;  % Granger causality test significance. Choose other 
                     % value if you have good reason for adopting different 
                     % one from frequency domain statistical testing. 
                     
igct_signif = alpha; % Instantaneous Granger causality test significance level.


%% Pretty-plot option parameters for xplot and xplot_pvalues function
%

flgScale = 2; % 1: [0 1] / {if max(PDC2/DTF2) > 1}:[0 max(PDC2/DTF2)]
%               2: [0 {if max(PDC/DTF2) > 1}:max(PDC/DTF2)]/[0 1]/[0 .1]/[0 .01]
%                                         based on flgMax (PDC2/DTF2/Thr/CI/all)
%               3: [0 max(PDC2/DTF2/Thr/CI/all)]
%                                         based on flgMax (PDC2/DTF2/Thr/CI/all)
%               4: [0 {max(PDC2/DTF2/Thr/CI/all) or round to {0.01 0.1 1.0}]

flgMax = 'all'; % {'PDC'|'DTF'|'Thr'|'CI'|'TCI'|'all'} measure used as upper limit
%                for y-axis scales:
%                    PDC|DTF - PDC2/DTF2 maximum value;
%                        Thr - Patnaik threshold maximum value;
%                        CI  - maximum upper confidence interval value;
%                        TCI - threshold or CI max value;
%                        all - plotted either max([PDC2/DTF2, Thr, CI]) value;
%               See also flgScale.

flgSignifColor = 3; % 0: black line
                    % 1: black / gray -> significant /not signif PDC/DTF
                    % 2: red  /  gray ->      "
                    % 3: red  / green ->      "
                    % 4: red  / black ->      "
                    % 5: black / green

flgColor = [0 1]; % Plotting option for automatic scaling for small PDC
                  % values.
                  % if flgColor = 0, y-axis scale = [0 1]
                  % elseif flgColor = 1, the pdc_xplot routine rescales 
                  % the y-axis automatically according to the following 
                  % rules:
                  %   if .01<=PDC(f) < .1 background-color = light-blue,
                  %                          so that y-axis scale = [0 .1]
                  %   elseif PDC(f) < .01 background-color = light-purple
                  %                          and y-axis = [0 .01];
                  % for flgColor=[0 1], both lay-outs are plotted.


%                 1 2 3 4 5 6 7
flgPrinting   =  [1 1 1 2 2 0 1]; % Example: Plot everything, except coh2.
%           blue  | | | | | | 7REPLACE_WITH_DASH_DASH {0:5} Spectra (0: w/o; 1: Linear; 2: Log;
%                 | | | | | |           3: PDC2; 4: Linear normalized;
%                 | | | | | |           5: Log spectra + PDC2)
%           gray  | | | | | 6REPLACE_WITH_DASH_DASH {0:1} Coh2 (0: w/o Coh2; 1: w Coh2)
%    dark-purple  | | | | 5REPLACE_WITH_DASH_DASH {0:3} Print GCT p-values and dot-mark significant
%  or dark-green  | | | |           connectivity channel-pair (0: w/o;
%                 | | | |           1: p-values; 2: dot-mark +GCT;
%                 | | | |           3: p-values + dot-mark significant GCT)
%    dashed-blue  | | | 4REPLACE_WITH_DASH_DASH {0:4} Confidence interval (0:w/o; 1: Dashed-lines;
%                 | | |           2: Shaded-plot; 3: Error-bar 1; 4: Error-bar 2
%            red  | | 3REPLACE_WITH_DASH_DASH {0:1} Significant PDC2|DTF2 in red lines
%   dashed-black  | 2REPLACE_WITH_DASH_DASH {0:1} Patnaik threshold level in black dashed-lines
%          green  1REPLACE_WITH_DASH_DASH {0:1} PDC2/DTF2 in green lines or black w/o statistics,
%                           see flgSignifColor bellow for line color selection.

w = fs*(0:(nFreqs-1))/2/nFreqs; % frequency scale

% maximum frequency to plot in frequency domain measures
w_max = fs/2; %<***> Usually half of sampling frequency, the Nyquist frequency


%==========================================================================
%==========================================================================
%        WARNING: BELOW THIS LINE PROBABLY YOU MIGHT NOT WANT TO EDIT,
%            UNLESS YOU NEED TO CUSTOMIZE YOUR ANALYSIS ROUTINE.
%==========================================================================

%==========================================================================
%                    Detrend and standardization options
%==========================================================================


% Determine time series length and check if data is row-wise organized.
[nChannels,nSegLength]=size(u);
if nChannels > nSegLength, u=u.'; 
   [nChannels,nSegLength]=size(u); % Transpose if not.
end

if flgDetrend
   for i=1:nChannels, u(i,:)=detrend(u(i,:)); end
   disp('Time series were detrended.');
end

if flgStandardize
   for i=1:nChannels, u(i,:)=u(i,:)/std(u(i,:)); end
   disp('Time series were scale-standardized.');
end



%==========================================================================
% Additional info for title (optional)

strTitle1 = [];

%==================
switch alg
  case 1
    disp('VAR estimation using Nutall-Strand algorithm.')
  case 2
    disp('VAR estimation using least-squares estimator.')
  case 3
    disp('VAR estimation using Vieira-Morf algorithm.')
  case 4
    disp('VAR estimation using QR-Arfit algorithm.')
end

%================================#
%   MAR order selection criteria /
%================================#
switch criterion
   case 1
      disp('Model order selection criteria: AIC.')
   case 2
      disp('Model order selection criteria: Hanna-Quinn.')
   case 3
      disp('Model order selection criteria: Schwarz (BIC).')
   case 4
      disp('Model order selection criteria: FPE.')
   case 5
      disp('Model order selection criteria: fixed order in maxIP.')
   otherwise
      error('Model order selection criteria: NOT IMPLEMENTED YET.')
end

%==========================================================================
%    VAR model estimation
%==========================================================================
[IP,pf,A,pb,B,ef,eb,vaic,Vaicv] = mvar(u,maxIP,alg,criterion);

disp(['Number of channels = ' int2str(nChannels) ' with ' ...
       int2str(nSegLength) ' data points; MAR model order = ' int2str(IP) '.']);

%==========================================================================
%    Testing for adequacy of MAR model fitting through Portmanteau test
%==========================================================================
h = 20; % testing lag
aValueVAR = 1 - VARadequacy_signif;
flgPrintResults = 1;
[Pass,Portmanteau,st,ths] = mvarresidue(ef,nSegLength,IP,aValueVAR,h,...
                                                          flgPrintResults);

%==========================================================================
%         Granger causality test (GCT)
%==========================================================================
flgPrintResults = 1;
[Tr_gct, pValue_gct] = gct_alg(u,A,pf,gct_signif,flgPrintResults);

%==========================================================================
%         Instantaneous Granger causality test (iGCT)
%==========================================================================
flgPrintResults = 1;
[Tr_igct, pValue_igct] = igct_alg(u,A,pf,gct_signif,flgPrintResults);

%==========================================================================
%            PDC, threshold and confidence interval calculation.
%==========================================================================

% if alpha == 0, no asymptotic statistics is performed. ASYMP_PDC returns
% only the PDC. This option is much faster!!

c = asymp_pdc(u,A,pf,nFreqs,metric,alpha);

% If you want to print the Granger Causality Test p-values you need to
% assign these values to c struct variable
c.Tragct = Tr_gct;
c.pvaluesgct = pValue_gct;

%                    or 
% c=asymp_dtf(u,A,pf,nFreqs,metric,alpha); % for DTF analysis

%% Adding further analysis details to the figure title.
%

% strTitle3 = ['[N=' int2str(nSegLength) 'pts; IP=' int2str(c.p) '; ' ...
%    datestr(now) ']'];
strTitle3 = ['[N=' int2str(nSegLength) 'pts; IP=' int2str(c.p) ']'];

% or leave it empty: strTitle3=[];

%==========================================================================
%              Matrix Layout Plotting of the Analysis Results
%==========================================================================

w_max = fs/2;
strTitle = [strTitle1 strTitle2 strTitle3];
strWindowName = 'PDC/DTF/GCT Analysis Template Example';

% The following "for loop" through flgColor values, 0 and 1, and yields a
% pair of plots, one without and other with color scale rearrangement option.
% Value range of PDC and Coherence is from [0 1], but sometimes the maximum 
% peak value is small (<0.1), or even smaller, (<.01), so in these cases it
% might be interesting to have a plot with finer smaller y-axis scale. The
% white-background plot indicates full-scale [0 1] y-axis, while
% light-blue-background stands for intermediate [0 .1] scaling and
% light-purple-background shows very fine detail of small, usually not
% significant PDCs. Try flgColor = 0 or 1, or both [0 1].

flgColor = [0 1];

for kflgColor = flgColor
   if kflgColor 
       strWindowName = 'xplot FUNCTION **WITH** background scale color.';
   else
       strWindowName = 'xplot FUNCTION **WITHOUT** background scale color.';
   end
   
   flgPrinting   =  [1 1 1 2 0 0 1];   
   %           blue  | | | | | | 7REPLACE_WITH_DASH_DASH {1} Spectra 1: Linear scale
   %           gray  | | | | | 6REPLACE_WITH_DASH_DASH {0} Without Coh2
   %    dark-purple  | | | | 5REPLACE_WITH_DASH_DASH {0} GCT 0: without
   %    dashed-blue  | | | 4REPLACE_WITH_DASH_DASH {2} Confidence interval 2: Shaded-plot
   %            red  | | 3REPLACE_WITH_DASH_DASH {1} Significant PDC2|DTF2 in red lines
   %   dashed-black  | 2REPLACE_WITH_DASH_DASH {1} Patnaik threshold level in black dashed-lines
   %          green  1REPLACE_WITH_DASH_DASH {1} PDC2 in green lines or black w/o statistics,

   [h2,~,~] = xplot(strWindowName,c,flgPrinting,fs,w_max,chLabels, ...
                                 kflgColor,flgScale,flgMax,flgSignifColor);
   xplot_title(alpha,metric,'pdc',strTitle);
   pause(3)

   flgPrinting   =  [1 1 1 2 3 0 0];   
   %           blue  | | | | | | 7REPLACE_WITH_DASH_DASH {0} No plotting on main diagonal
   %           gray  | | | | | 6REPLACE_WITH_DASH_DASH {0} Without Coh2
   %    dark-purple  | | | | 5REPLACE_WITH_DASH_DASH {3} Print GCT 3: p-values + dot-mark significant GCT
   %    dashed-blue  | | | 4REPLACE_WITH_DASH_DASH {4} Confidence interval 2: Shaded-plot
   %            red  | | 3REPLACE_WITH_DASH_DASH {1} Significant PDC2|DTF2 in red lines
   %   dashed-black  | 2REPLACE_WITH_DASH_DASH {1} Patnaik threshold level in black dashed-lines
   %          green  1REPLACE_WITH_DASH_DASH {1} PDC2 in green lines or black w/o statistics,

    [h2,~,~] = xplot(strWindowName,c,flgPrinting,fs,w_max,chLabels, ...
                                 kflgColor,flgScale,flgMax,flgSignifColor);
   xplot_title(alpha,metric,'pdc',strTitle);
   pause(3) % Pause to allow figure visualization during analysis
   
end

%==========================================================================
%              Matrix Layout Plotting of PDC p-values 
%==========================================================================
% See xplot_p-values() function for more details
%
%   flgPrinting: [1 1 1 2 3 0 0];
%           blue  | | | | | | 7REPLACE_WITH_DASH_DASH {0:2} Spectra (0: wo; 1: Linear; 2: Log) 
%                 | | | | | 6REPLACE_WITH_DASH_DASH {} Not used
%   dark-purple   | | | | 5REPLACE_WITH_DASH_DASH {0:3} Mark significant GCT pairs + print p-values   
%  or dark-green  | | | |          (0: w/o; 1: print p-values; 2: mark +GCT;
%                 | | | |           3: print p-values + mark significant GCT)
%    dashed-blue  | | | 4REPLACE_WITH_DASH_DASH {0:2} Scale of p-values plots 1:linear; 2:log10
%                 | | 3REPLACE_WITH_DASH_DASH {} Not used
%   dashed-black  | 2REPLACE_WITH_DASH_DASH {0:1} Patnaik threshold level in black dashed-line
%                 1REPLACE_WITH_DASH_DASH {} Not used

flgPrinting  =   [1 1 1 2 3 0 0];
flgScale = 2; % y-axis scale for p-values: 1: linear [0 1] and log [0 -15];
%                                          2: log y-axis according to 
%                                             max(abs(pvalues_log10)) value
%                                             [0 -5], [0 -10] or [0 -15]
strWindow = ['xplot_p-values FUNCTION to plot PDC p-values in frequency domain'];

[h3,~,~] = xplot_pvalues(strWindow,c,flgPrinting,fs,w_max,chLabels, ...
                                     flgColor,flgScale);
xplot_title(alpha,metric,strTitle)


%======================= xplot ========================================
%Plot legend:  Blue lines on the main diagonal = Power spectra;
%              Black dashed lines are Patnaik threshold for dtfn;
%              Green lines = non significant dtfn;
%              Red lines = significant dtfn;
%              Light-gray lines = coherence function.
%
% Notes:       a.The main diagonal of matrix layout contains power spectra.
%              b.Coherences are symmetric, e.g., 
%                   Coh_{Sunspot,Melanoma}(f) = Coh_{Melanoma,Sunspot}(f).
%              c.dtfn is asymmetric relation, and the dtfn graphics should
%              be read as if the flow of information is been from the
%              x-axis variable toward y-axis variable.
%
%              For sunspot and melanoma example, one only sees significant
%              dtfn from Sunspot to Melanoma, which could eventually be
%              interpreted that "Sunspot", or the Sun's activity
%              modulates the incidence of melanoma.
%======================= dtf_xplot ========================================
disp('======================================================================');
disp('============ ANALYSIS_TEMPLATE SUCCESSFULLY FINISHED =================')
disp('======================================================================');

##### SOURCE END #####
--></body></html>