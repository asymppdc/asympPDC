
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>BACCALA &amp; SAMESHIMA (2001b) - Model 2: 6-dim VAR[4] Scalp Model</title><meta name="generator" content="MATLAB 9.8"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2022-10-05"><meta name="DC.source" content="baccala2001b_model2.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>BACCALA &amp; SAMESHIMA (2001b) - Model 2: 6-dim VAR[4] Scalp Model</h1><!--introduction--><p>Description:</p><p>Baccala &amp; Sameshima. Overcoming the limitations of correlation analysis for many simultaneously processed neural structures, Progress in Brain Research, 130:33--47, 2001.</p><p><a href="http://dx.doi.org/10.1016/S0079-6123(01)30004-3">http://dx.doi.org/10.1016/S0079-6123(01)30004-3</a></p><p>Model II: 6-dimension VAR(4) Scalp model</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">See also: mvar, mvarresidue, asymp_pdc, asymp_dtf, gct_alg,</a></li><li><a href="#2">Data sample generation</a></li><li><a href="#3">Interaction diagram</a></li><li><a href="#4">Equation</a></li><li><a href="#6">MVAR model estimation</a></li><li><a href="#8">Granger causality test (GCT) and instantaneous GCT</a></li><li><a href="#9">Original PDC estimation</a></li><li><a href="#10"><img src="baccala2001b_model2_eq04653255622943413630.png" alt="$|PDC(\lambda)|^2$"> Matrix-Layout Plotting</a></li><li><a href="#12">Original DTF estimation</a></li><li><a href="#13"><img src="baccala2001b_model2_eq07741536688981312772.png" alt="$|DTF(\lambda)|^2$"> Matrix-Layout Plotting</a></li><li><a href="#14">Animation</a></li></ul></div><h2 id="1">See also: mvar, mvarresidue, asymp_pdc, asymp_dtf, gct_alg,</h2><pre>            igct_alg, xplot, xplot_pvalues</pre><pre class="codeinput"><span class="comment">% (C) Koichi Sameshima &amp; Luiz A. Baccal&aacute;, 2022.</span>
<span class="comment">% See file license.txt in installation directory for licensing terms.</span>

clear; clc; format <span class="string">compact</span>; format <span class="string">short</span>
</pre><h2 id="2">Data sample generation</h2><pre class="codeinput">nDiscard = 5000;    <span class="comment">% number of points discarded at beginning of simulation</span>
nPoints  = 2000;   <span class="comment">% number of analyzed samples points</span>
N=nDiscard+nPoints; <span class="comment">% number of simulated points</span>

u = fbaccala2001b_model2( nPoints, nDiscard );

[nSegLength,nChannels]=size(u);
chLabels = {<span class="string">'x_1'</span>;<span class="string">'x_2'</span>;<span class="string">'x_3'</span>;<span class="string">'x_4'</span>;<span class="string">'x_5'</span>;<span class="string">'x_6'</span>}; <span class="comment">% or chLabels = [];</span>
fs = 1;
</pre><pre class="codeoutput">======================================================================
                       Linear VAR[4] Model II
        Baccala &amp; Sameshima. Prog Brain Research, 130:33--47, 2001.
        x1==&gt;x2  x1==&gt;x4  x2==&gt;x3 x2--&gt;x5 x5==&gt;x6 x6--&gt;x4  x6==&gt;x5
======================================================================
</pre><h2 id="3">Interaction diagram</h2><p><img vspace="5" hspace="5" src="fig_baccala2001b_model2_graph.png" alt=""> </p><p>Figure 9 from Baccala &amp; Sameshima. <i>Progr in Brain Res</i>, 130:33--47, 2001.</p><h2 id="4">Equation</h2><p><img vspace="5" hspace="5" src="fig_baccala2001b_model2_eq.png" alt=""> </p><p>Data checking and pre-processing: detrending and normalization options</p><pre class="codeinput">flgDetrend = 1;     <span class="comment">% Detrending the data set</span>
flgStandardize = 0; <span class="comment">% No standardization</span>
[nChannels,nSegLength] =size(u);
<span class="keyword">if</span> nChannels &gt; nSegLength
   u = u.';
   [nChannels,nSegLength]=size(u);
<span class="keyword">end</span>
<span class="keyword">if</span> flgDetrend
   <span class="keyword">for</span> i=1:nChannels, u(i,:)=detrend(u(i,:)); <span class="keyword">end</span>
   disp(<span class="string">'Time series were detrended.'</span>);
<span class="keyword">end</span>
<span class="keyword">if</span> flgStandardize
   <span class="keyword">for</span> i=1:nChannels, u(i,:)=u(i,:)/std(u(i,:)); <span class="keyword">end</span>
   disp(<span class="string">'Time series were scale-standardized.'</span>);
<span class="keyword">end</span>
</pre><pre class="codeoutput">Time series were detrended.
</pre><h2 id="6">MVAR model estimation</h2><pre class="codeinput">disp(<span class="string">'Running MVAR estimation routine.'</span>)
maxIP = 30;         <span class="comment">% maximum model order to consider.</span>
alg = 1;            <span class="comment">% 1: Nutall-Strand MVAR estimation algorithm</span>
criterion = 1;      <span class="comment">% 1: AIC, Akaike Information Criteria</span>
[IP,pf,A,pb,B,ef,eb,vaic,Vaicv] = mvar(u,maxIP,alg,criterion);

disp([<span class="string">'Number of channels = '</span> int2str(nChannels) <span class="string">' with '</span> <span class="keyword">...</span>
    int2str(nSegLength) <span class="string">' data points; MAR model order = '</span> int2str(IP) <span class="string">'.'</span>]);
</pre><pre class="codeoutput">Running MVAR estimation routine.
maxOrder limited to 30
IP=1  vaic=102001.171160
IP=2  vaic=92433.773243
IP=3  vaic=91542.563812
IP=4  vaic=91358.805367
IP=5  vaic=91389.028710
 
Number of channels = 6 with 2000 data points; MAR model order = 4.
</pre><p>Testing for adequacy of MAR model fitting through Portmanteau test</p><pre class="codeinput">h = 20; <span class="comment">% testing lag</span>
MVARadequacy_signif = 0.05; <span class="comment">% VAR model estimation adequacy significance</span>
                            <span class="comment">% level</span>
aValueMVAR = 1 - MVARadequacy_signif; <span class="comment">% Confidence value for the testing</span>

flgPrintResults = 1; <span class="comment">% Print results on Command Window</span>
[Pass,Portmanteau,st,ths] = mvarresidue(ef,nSegLength,IP,aValueMVAR,h,<span class="keyword">...</span>
                                           flgPrintResults);
</pre><pre class="codeoutput">
====================================================================================================
                  MVAR RESIDURES TEST FOR WHITENESS
----------------------------------------------------------------------------------------------------
Good MAR model fitting! Residues white noise hypothesis NOT rejected.
Pass = 0.0208333
  st = 571.395
</pre><h2 id="8">Granger causality test (GCT) and instantaneous GCT</h2><pre class="codeinput">gct_signif  = 0.01;  <span class="comment">% Granger causality test significance level</span>
igct_signif = 0.01;  <span class="comment">% Instantaneous GCT significance level</span>
flgPrintResults = 1;

[Tr_gct, pValue_gct]   =  gct_alg(u,A,pf, gct_signif,flgPrintResults);
[Tr_igct, pValue_igct] = igct_alg(u,A,pf,igct_signif,flgPrintResults);
</pre><pre class="codeoutput">
====================================================================================================
                         GRANGER CAUSALITY TEST
----------------------------------------------------------------------------------------------------
Connectivity matrix:
   NaN     1     0     0     0     0
     1   NaN     0     1     0     0
     1     1   NaN     0     0     0
     1     1     0   NaN     0     1
     1     1     0     1   NaN     1
     0     0     0     0     1   NaN

Granger causality test p-values:
       NaN    0.0094    0.2234    0.8569    0.4574    0.7262
         0       NaN    0.8492    0.0024    0.1377    0.0870
    0.0000         0       NaN    0.0273    0.8408    0.4952
         0    0.0004    0.1541       NaN    0.9081         0
    0.0024         0    0.4755    0.0056       NaN         0
    0.7735    0.9276    0.2898    0.3775         0       NaN

====================================================================================================
                  INSTANTANEOUS GRANGER CAUSALITY TEST
----------------------------------------------------------------------------------------------------
Instantaneous connectivity matrix:
   NaN     0     0     0     0     0
     0   NaN     0     0     0     1
     0     0   NaN     0     0     0
     0     0     0   NaN     0     0
     0     0     0     0   NaN     0
     0     1     0     0     0   NaN

Instantaneous Granger Causality test p-values:
       NaN    0.9111    0.2752    0.8538    0.2406    0.5991
    0.9111       NaN    0.5257    0.4133    0.4014    0.0009
    0.2752    0.5257       NaN    0.4961    0.1276    0.4198
    0.8538    0.4133    0.4961       NaN    0.9877    0.2176
    0.2406    0.4014    0.1276    0.9877       NaN    0.5068
    0.5991    0.0009    0.4198    0.2176    0.5068       NaN

&gt;&gt;&gt;&gt; There is a pair of channels with significant Instantaneous 
     Granger Causality.

====================================================================================================
</pre><h2 id="9">Original PDC estimation</h2><p>PDC analysis results are saved in <b>c</b> struct. See asymp_pdc.m for more detail.</p><pre class="codeinput">nFreqs = 128;  <span class="comment">% Number of points in the frequency scale.</span>
alpha  = 0.01; <span class="comment">% Significance level for PDC testing</span>
metric = <span class="string">'euc'</span>;  <span class="comment">% euc  = Euclidean, original PDC or DTF;</span>
                 <span class="comment">% diag = generalized PDC, gPDC, or  gDTF / DC;</span>
                 <span class="comment">% info = information PDC, iPDC, or  iDTF.</span>
c = asymp_pdc(u,A,pf,nFreqs,metric,alpha); <span class="comment">% Estimate PDC and asymptotic statistics</span>
c.Tragct = Tr_gct;
c.pvaluesgct = pValue_gct;
</pre><h2 id="10"><img src="baccala2001b_model2_eq04653255622943413630.png" alt="$|PDC(\lambda)|^2$"> Matrix-Layout Plotting</h2><pre class="codeinput">flgPrinting = [1 1 1 2 3 1 2];
flgColor = 1;
flgScale = 1;
flgMax = <span class="string">'tci'</span>;
flgSignifColor = 3; <span class="comment">% Line color for PDC2/DTF2 plotting on the frequency scale.</span>
<span class="comment">%                     3: red (significat) / green (not significant)</span>
w_max = fs/2;

strTitle = [<span class="string">'6-dimension linear VAR[4] Model II: [N='</span> int2str(nSegLength) <span class="keyword">...</span>
            <span class="string">'pts; IP='</span> int2str(c.p) <span class="string">']'</span>];
strID = <span class="string">'Baccala &amp; Sameshima (2001b) Model II'</span>; <span class="comment">% figure window bar ID</span>
[h1,~,~] = xplot(strID,c,flgPrinting,fs,w_max,chLabels, <span class="keyword">...</span>
                                       flgColor,flgScale,flgMax,flgSignifColor);
xplot_title(alpha,metric,<span class="string">'pdc'</span>, strTitle);
</pre><img vspace="5" hspace="5" src="baccala2001b_model2_01.png" alt=""> <p>Result from the original article, Baccala &amp; Sameshima (2001b) Figure 6b.</p><p><img vspace="5" hspace="5" src="fig_baccala2001b_model2_pdc_result.png" alt=""> </p><h2 id="12">Original DTF estimation</h2><p>DTF analysis results are saved in <b>d</b> struct.</p><pre class="codeinput">d = asymp_dtf(u,A,pf,nFreqs,metric,alpha); <span class="comment">% Estimate DTF and asymptotic statistics</span>
</pre><h2 id="13"><img src="baccala2001b_model2_eq07741536688981312772.png" alt="$|DTF(\lambda)|^2$"> Matrix-Layout Plotting</h2><pre class="codeinput">flgPrinting = [1 0 1 2 0 1 2]; <span class="comment">% not plotting threshold and coherence</span>
[h2,~,~] = xplot(strID,d,flgPrinting,fs,w_max,chLabels, <span class="keyword">...</span>
                                       flgColor,flgScale,flgMax,flgSignifColor);
xplot_title(alpha,metric,<span class="string">'dtf'</span>, strTitle);
</pre><img vspace="5" hspace="5" src="baccala2001b_model2_02.png" alt=""> <h2 id="14">Animation</h2><p>Gif <a href="<fig_gif_baccala2001b_escalp_eeg_pdc.gif">&lt;fig_gif_baccala2001b_escalp_eeg_pdc.gif</a>&gt;</p><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% BACCALA & SAMESHIMA (2001b) - Model 2: 6-dim VAR[4] Scalp Model
%
% Description:
%
% Baccala & Sameshima. Overcoming the limitations of correlation analysis 
% for many simultaneously processed neural structures, Progress in Brain 
% Research, 130:33REPLACE_WITH_DASH_DASH47, 2001.
%
% <http://dx.doi.org/10.1016/S0079-6123(01)30004-3>
% 
% Model II: 6-dimension VAR(4) Scalp model
%
%% See also: mvar, mvarresidue, asymp_pdc, asymp_dtf, gct_alg, 
%              igct_alg, xplot, xplot_pvalues             

% (C) Koichi Sameshima & Luiz A. Baccalá, 2022. 
% See file license.txt in installation directory for licensing terms.

clear; clc; format compact; format short

%% Data sample generation

nDiscard = 5000;    % number of points discarded at beginning of simulation
nPoints  = 2000;   % number of analyzed samples points
N=nDiscard+nPoints; % number of simulated points

u = fbaccala2001b_model2( nPoints, nDiscard );

[nSegLength,nChannels]=size(u);
chLabels = {'x_1';'x_2';'x_3';'x_4';'x_5';'x_6'}; % or chLabels = [];
fs = 1;

%% Interaction diagram
%
% <<fig_baccala2001b_model2_graph.png>>
%
% Figure 9 from Baccala & Sameshima. _Progr in Brain Res_, 130:33REPLACE_WITH_DASH_DASH47, 2001.

%% Equation
%
% <<fig_baccala2001b_model2_eq.png>>
%

%%
% Data checking and pre-processing: detrending and normalization options

flgDetrend = 1;     % Detrending the data set
flgStandardize = 0; % No standardization
[nChannels,nSegLength] =size(u);
if nChannels > nSegLength
   u = u.'; 
   [nChannels,nSegLength]=size(u);
end
if flgDetrend
   for i=1:nChannels, u(i,:)=detrend(u(i,:)); end
   disp('Time series were detrended.');
end
if flgStandardize
   for i=1:nChannels, u(i,:)=u(i,:)/std(u(i,:)); end
   disp('Time series were scale-standardized.');
end

%% MVAR model estimation
%

disp('Running MVAR estimation routine.')
maxIP = 30;         % maximum model order to consider.
alg = 1;            % 1: Nutall-Strand MVAR estimation algorithm
criterion = 1;      % 1: AIC, Akaike Information Criteria
[IP,pf,A,pb,B,ef,eb,vaic,Vaicv] = mvar(u,maxIP,alg,criterion);

disp(['Number of channels = ' int2str(nChannels) ' with ' ...
    int2str(nSegLength) ' data points; MAR model order = ' int2str(IP) '.']);

%%
% Testing for adequacy of MAR model fitting through Portmanteau test
%

h = 20; % testing lag
MVARadequacy_signif = 0.05; % VAR model estimation adequacy significance
                            % level
aValueMVAR = 1 - MVARadequacy_signif; % Confidence value for the testing

flgPrintResults = 1; % Print results on Command Window
[Pass,Portmanteau,st,ths] = mvarresidue(ef,nSegLength,IP,aValueMVAR,h,...
                                           flgPrintResults);

%% Granger causality test (GCT) and instantaneous GCT
%

gct_signif  = 0.01;  % Granger causality test significance level
igct_signif = 0.01;  % Instantaneous GCT significance level
flgPrintResults = 1;

[Tr_gct, pValue_gct]   =  gct_alg(u,A,pf, gct_signif,flgPrintResults);
[Tr_igct, pValue_igct] = igct_alg(u,A,pf,igct_signif,flgPrintResults);


%% Original PDC estimation
%
% PDC analysis results are saved in *c* struct.
% See asymp_pdc.m for more detail. 

nFreqs = 128;  % Number of points in the frequency scale.
alpha  = 0.01; % Significance level for PDC testing 
metric = 'euc';  % euc  = Euclidean, original PDC or DTF;
                 % diag = generalized PDC, gPDC, or  gDTF / DC;
                 % info = information PDC, iPDC, or  iDTF.
c = asymp_pdc(u,A,pf,nFreqs,metric,alpha); % Estimate PDC and asymptotic statistics
c.Tragct = Tr_gct;
c.pvaluesgct = pValue_gct;

%% $|PDC(\lambda)|^2$ Matrix-Layout Plotting

flgPrinting = [1 1 1 2 3 1 2];
flgColor = 1;
flgScale = 1;
flgMax = 'tci';
flgSignifColor = 3; % Line color for PDC2/DTF2 plotting on the frequency scale.
%                     3: red (significat) / green (not significant) 
w_max = fs/2;

strTitle = ['6-dimension linear VAR[4] Model II: [N=' int2str(nSegLength) ...
            'pts; IP=' int2str(c.p) ']'];
strID = 'Baccala & Sameshima (2001b) Model II'; % figure window bar ID
[h1,~,~] = xplot(strID,c,flgPrinting,fs,w_max,chLabels, ...
                                       flgColor,flgScale,flgMax,flgSignifColor);
xplot_title(alpha,metric,'pdc', strTitle);

%% 
% Result from the original article, Baccala & Sameshima (2001b) 
% Figure 6b.
%
% <<fig_baccala2001b_model2_pdc_result.png>>
% 

%% Original DTF estimation
% DTF analysis results are saved in *d* struct.
%

d = asymp_dtf(u,A,pf,nFreqs,metric,alpha); % Estimate DTF and asymptotic statistics

%% $|DTF(\lambda)|^2$ Matrix-Layout Plotting
%

flgPrinting = [1 0 1 2 0 1 2]; % not plotting threshold and coherence
[h2,~,~] = xplot(strID,d,flgPrinting,fs,w_max,chLabels, ...
                                       flgColor,flgScale,flgMax,flgSignifColor);
xplot_title(alpha,metric,'dtf', strTitle);


%% Animation
% Gif
% <<fig_gif_baccala2001b_escalp_eeg_pdc.gif>>



##### SOURCE END #####
--></body></html>