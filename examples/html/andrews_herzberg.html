
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>ANDREWS &amp; HERZBERG (1985)a - Sunspot-Melanoma 1936-1972 Series PDC Demo</title><meta name="generator" content="MATLAB 9.8"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2022-10-26"><meta name="DC.source" content="andrews_herzberg.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>ANDREWS &amp; HERZBERG (1985)a - Sunspot-Melanoma 1936-1972 Series PDC Demo</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Data File: skin.dat</a></li><li><a href="#3">Causality Analysis using Partial Directed Coherence (PDC)</a></li><li><a href="#4">Additional References</a></li><li><a href="#5">Retrieving data set for analysis from sunmeladat.m m-file</a></li><li><a href="#6">Plotting sunspot and melanoma series</a></li><li><a href="#10">MVAR model estimation</a></li><li><a href="#12">Granger causality test (GCT) and instantaneous GCT</a></li><li><a href="#13">Original definition of PDC estimation</a></li><li><a href="#14">Plotting PDC original in Matrix Layout without asymptotic statistics</a></li><li><a href="#16">Showing more detail by changing the scale and adding color information</a></li><li><a href="#18">Generalized PDC estimation and analysis parameters</a></li><li><a href="#19">Generalized PDC Matrix Layout Plotting</a></li><li><a href="#21">Repeating the analysis with Information PDC</a></li><li><a href="#22">iPDC with alpha = 1% analysis Matrix Layout Plotting</a></li><li><a href="#24">Plotting the PDC p-values in the frequency domain</a></li></ul></div><h2 id="1">Data File: skin.dat</h2><p>This data is from:    D. F. Andrews, A. M. Herzberg. (1985) Data: A Collection of Problems from    Many Fields for the Student and Research Worker. Springer, New York.</p><p>"The aetiology of melanoma is complex and may include the influences of trauma, heredity and hormonal activity. In particular, exposure to solar radiation may be involved in the pathogenesis of melanoma. Melanoma is more common in fair-skinned individuals and most frequent in skin sites exposed to the sun. In white populations melanoma is more common in areas closer to the equator where the intensity of solar radiation is higher. Data from various parts of the world suggest that the incidence of melanoma is increasing. The data below, giving age-adjusted melanoma incidence, are from the Connecticut Tumor Registry from 1936-1972. Connecticut has the longest record of state population-based cancer statistics in the United States of America. The data also includes the sunspot relative number. Houghton, Munster and Viola (1978) have shown that the age-adjusted incidence rate for malignant melanoma in the state of Connecticut has risen since 1935 and that superimposed on the rise are 3-5 year periods in which the rise in the rate of incidence is excessive. These periods have a cycle of 8-11 years and follow times of maximum sunspot activity. The relationship between solar cycles and melanoma supports the hypothesis that melanoma is related to sun exposure and provides evidence that solar radiation may trigger the development of clinically apparent melanoma. The columns are the year, male incidence, total incidence, and sunspot relative index. The incidence are rates per 100,000." (Andrews &amp; Herzberg, 1985)</p><p>Below is the contents of the file skin.dat:</p><div><ul><li>Year % 1936-1972</li><li>ANNUAL MALE MELANOMA INCIDENCE(AGE-ADJUSTED PER 10**5) CONNECTICUT</li><li>ANNUAL TOTAL MELANOMA INCIDENCE(AGE-ADJUSTED PER 10**5) CONNECTICUT</li><li>ANNUAL SUNSPOT RELATIVE NUMBER</li></ul></div><h2 id="3">Causality Analysis using Partial Directed Coherence (PDC)</h2><p>In this example, ANNUAL SUNSPOT RELATIVE NUMBER and TOTAL MELANOMA INCIDENCE(AGE-ADJUSTED PER 10**5) in the state of CONNECTICUT will be considered</p><h2 id="4">Additional References</h2><p>[0] Andrews, D.F., Herzberg, A.M. (1985). Incidence of Malignant Melanoma     After Peaks of Sunspot Activity. In: Data. Springer Series in Statistics.     Springer, New York, NY. <a href="https://doi.org/10.1007/978-1-4612-5098-2_33">https://doi.org/10.1007/978-1-4612-5098-2_33</a></p><p>[1] M.V. Viola, A. Houghton, E.W. Munster. Solar cycles and malignant melanoma.     Medical Hypotheses 5:153--160, 1979.       <a href="https://doi.org/10.1016/0306-9877(79)90067-7">https://doi.org/10.1016/0306-9877(79)90067-7</a></p><p>[2] A. Houghton, E.W. Munster and M.V. Viola. Increased incidence of     malignant melanoma after peaks of sunspot activity. The Lancet,     311:759--760, 1978.       <a href="https://doi.org/10.1016/S0140-6736(78)90869-3">https://doi.org/10.1016/S0140-6736(78)90869-3</a></p><pre class="codeinput"><span class="comment">% (C) Koichi Sameshima &amp; Luiz A. Baccala, 2021. See file license.txt in</span>
<span class="comment">% installation directory for licensing terms.</span>

clear; clc; format <span class="string">compact</span>

format <span class="string">short</span>
warning(<span class="string">'off'</span>); more <span class="string">off</span>

disp(repmat(<span class="string">'='</span>,1,100))
disp(<span class="string">'     Andrews and Herzberg''s Sunspot and Melanoma 1936-1972 Data'</span>);
disp(<span class="string">'                 Sunspot --&gt; Melanoma or other way?'</span>);
disp(repmat(<span class="string">'='</span>,1,100))

flgDataPlot = 1;
</pre><pre class="codeoutput">====================================================================================================
     Andrews and Herzberg's Sunspot and Melanoma 1936-1972 Data
                 Sunspot --&gt; Melanoma or other way?
====================================================================================================
</pre><h2 id="5">Retrieving data set for analysis from sunmeladat.m m-file</h2><pre class="codeinput">x=sunmeladat([4 3]); chLabels={<span class="string">'Sunspot'</span>;<span class="string">'Melanoma'</span>};
u = x;
nPoints = length(u);
</pre><h2 id="6">Plotting sunspot and melanoma series</h2><pre class="codeinput"><span class="keyword">if</span> flgDataPlot
   year=sunmeladat(1);  <span class="comment">% Year variable</span>
   h1=figure;
   set(h1,<span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="string">'MenuBar'</span>,<span class="string">'none'</span>, <span class="keyword">...</span>
      <span class="string">'Name'</span>,<span class="string">'Andrews &amp; Herzberg''s Sunspot-Melanoma Series (1936-1972)'</span>)

   h11 = subplot(311); plot(year,u(:,1),<span class="string">'o:r'</span>); title(<span class="string">'Sunspot series'</span>); grid
   set(h11,<span class="string">'XLim'</span>, [1935 1975], <span class="string">'XTick'</span>,[1935:5:1975], <span class="keyword">...</span>
                            <span class="string">'XTickLabel'</span>,[<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>]);

   h12 = subplot(312); plot(year,u(:,2),<span class="string">'.:'</span>);
                     xlabel(<span class="string">''</span>);
                     title(<span class="string">'Melanoma series'</span>);grid
   set(h12,<span class="string">'XLim'</span>, [1935 1975],<span class="string">'XTick'</span>,[1935:5:1975], <span class="keyword">...</span>
                            <span class="string">'XTickLabel'</span>,[<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>;<span class="string">' '</span>]);

   h13 = subplot(313); plot(year,detrend(u(:,2)),<span class="string">'.:'</span>); xlabel(<span class="string">'year'</span>);
   set(h13,<span class="string">'XLim'</span>, [1935 1975])
   title(<span class="string">'Detrended Melanoma series'</span>)
   grid; hold <span class="string">on</span>;
   shg; pause(3)
   h2=figure;
   set(h2,<span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="string">'MenuBar'</span>,<span class="string">'none'</span>, <span class="keyword">...</span>
      <span class="string">'Name'</span>,<span class="string">'Andrews &amp; Herzberg''s Sunspot-Melanoma Series (1936-1972)'</span>)
   u2=u(:,2); u2=detrend(u2);

   h21 = subplot(211); plot(year,(u2-mean(u2))/std(u2),<span class="string">'b*:'</span>,<span class="keyword">...</span>
      year,(u(:,1)-mean(u(:,1)))/std(u(:,1)),<span class="string">'ro:'</span>);
   xlabel(<span class="string">'year'</span>);
   set(h21,<span class="string">'XLim'</span>, [1935 1975])
   title(<span class="string">'Melanoma &amp; Sunspot: Standardized series'</span>)
   legend(<span class="string">'Melanoma'</span>,<span class="string">'Sunspot'</span>);grid

   [uxcorr,lag] = xcorr(u2,u(:,1),<span class="string">'coeff'</span>);
   subplot(212); h22 = plot(lag,uxcorr,<span class="string">'o'</span>); xlabel(<span class="string">'lag(year)'</span>);
   title(<span class="string">'Normalized cross-correlation function'</span>); axis([-20 20 -1 1]);
   grid; hold <span class="string">on</span>
   plot(2,uxcorr(39),<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,15) <span class="comment">% Peak of cross-correlation.</span>
   shg; pause(3)
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="andrews_herzberg_01.png" alt=""> <img vspace="5" hspace="5" src="andrews_herzberg_02.png" alt=""> <p>Note the cross-correlation peak at 2-year time lag (filled circle).</p><p>Although for plotting purpose the Sunspot series was standardized, in the analyses that follow <b>the time series were not standardized</b>, and consequently the variance of Sunspot series is much larger than that of the Melanoma's series. This may give misleading high <b>Original PDC</b> values, although not significant, from <b>Melanoma to Sunspot</b>, as seen in the following analysis.</p><p>Data pre-processing: detrending and standardization options</p><pre class="codeinput">flgDetrend = 1;     <span class="comment">% Detrending the data set</span>
flgStandardize = 0; <span class="comment">% No standardization</span>
[nChannels,nSegLength] =size(u);
<span class="keyword">if</span> nChannels &gt; nSegLength,
   u = u.';
   [nChannels,nSegLength]=size(u);
<span class="keyword">end</span>
<span class="keyword">if</span> flgDetrend
   <span class="keyword">for</span> i=1:nChannels, u(i,:)=detrend(u(i,:)); <span class="keyword">end</span>
   disp(<span class="string">'Time series were detrended.'</span>);
<span class="keyword">end</span>
<span class="keyword">if</span> flgStandardize
   <span class="keyword">for</span> i=1:nChannels, u(i,:)=u(i,:)/std(u(i,:)); <span class="keyword">end</span>
   disp(<span class="string">'Time series were scale-standardized.'</span>);
<span class="keyword">end</span>

alpha_c = 0.01;
fs= 1; <span class="comment">% Sampling frequency: 1 sample/year.</span>
</pre><pre class="codeoutput">Time series were detrended.
</pre><h2 id="10">MVAR model estimation</h2><pre class="codeinput">maxIP = 4;         <span class="comment">% maximum model order to consider.</span>
alg = 1;            <span class="comment">% 1: Nutall-Strand MVAR estimation algorithm;</span>
<span class="comment">%                   % 2: minimum least squares methods;</span>
<span class="comment">%                   % 3: Vieira Morf algorithm;</span>
<span class="comment">%                   % 4: QR ARfit algorith.</span>

criterion = 1;      <span class="comment">% Criterion for order choice:</span>
<span class="comment">%                   % 1: AIC, Akaike Information Criteria;</span>
<span class="comment">%                   % 2: Hanna-Quinn;</span>
<span class="comment">%                   % 3: Schwarz;</span>
<span class="comment">%                   % 4: FPE;</span>
<span class="comment">%                   % 5: fixed order given by maxIP value.</span>

disp(<span class="string">'Running MVAR estimation routine...'</span>)
[IP,pf,A,pb,B,ef,eb,vaic,Vaicv] = mvar(u,maxIP,alg,criterion);
disp([<span class="string">'Number of channels = '</span> int2str(nChannels) <span class="string">' with '</span> <span class="keyword">...</span>
    int2str(nSegLength) <span class="string">' data points; MAR model order = '</span> int2str(IP) <span class="string">'.'</span>]);
</pre><pre class="codeoutput">Running MVAR estimation routine...
maxOrder limited to 4
IP=1  vaic=418.156614
IP=2  vaic=415.350982
IP=3  vaic=409.454496
IP=4  vaic=411.220477
 
Number of channels = 2 with 37 data points; MAR model order = 3.
</pre><p>Testing for adequacy of MAR model fitting through the Portmanteau test</p><pre class="codeinput">h = 20; <span class="comment">% testing lag</span>
MVARadequacy_signif = 0.05; <span class="comment">% VAR model estimation adequacy significance level</span>
aValueMVAR = 1 - MVARadequacy_signif; <span class="comment">% Confidence value for the testing</span>
flgPrintResults = 1;                  <span class="comment">% Print results in the Command Window</span>
[Pass,Portmanteau,st,ths] = mvarresidue(ef,nSegLength,IP,aValueMVAR,h,<span class="keyword">...</span>
                                           flgPrintResults);
</pre><pre class="codeoutput">
====================================================================================================
                  MVAR RESIDURES TEST FOR WHITENESS
----------------------------------------------------------------------------------------------------
Good MAR model fitting! Residues white noise hypothesis NOT rejected.
Pass = 0.025
  st = 85.8928
</pre><h2 id="12">Granger causality test (GCT) and instantaneous GCT</h2><pre class="codeinput">gct_signif  = 0.01;  <span class="comment">% Granger causality test significance level</span>
igct_signif = 0.01;  <span class="comment">% Instantaneous GCT significance level</span>
flgPrintResults = 1; <span class="comment">% Flag to print gct_alg.m results on Command Window.</span>
[Tr_gct, pValue_gct,]  = gct_alg(u,A,pf,gct_signif,flgPrintResults);
[Tr_igct, pValue_igct] = igct_alg(u,A,pf,igct_signif,flgPrintResults);
</pre><pre class="codeoutput">
====================================================================================================
                         GRANGER CAUSALITY TEST
----------------------------------------------------------------------------------------------------
Connectivity matrix:
   NaN     0
     1   NaN

Granger causality test p-values:
       NaN    0.0796
    0.0000       NaN

====================================================================================================
                  INSTANTANEOUS GRANGER CAUSALITY TEST
----------------------------------------------------------------------------------------------------
Instantaneous connectivity matrix:
   NaN     0
     0   NaN

Instantaneous Granger Causality test p-values:
       NaN    0.0762
    0.0762       NaN

&gt;&gt;&gt;&gt; Instantaneous Granger Causality NOT detected.

====================================================================================================
</pre><h2 id="13">Original definition of PDC estimation</h2><p>PDC analysis results are saved in <b>c</b> struct variable. See <b>asymp_pdc.m</b> for more detail.</p><pre class="codeinput">nFreqs = 128;
metric = <span class="string">'euc'</span>;  <span class="comment">% euc  = original PDC or DTF;</span>
                 <span class="comment">% diag = generalized PDC (gPDC) or DC;</span>
                 <span class="comment">% info = information PDC (iPDC) or iDTF.</span>
alpha_c = 0.01;
c = asymp_pdc(u,A,pf,nFreqs,metric,alpha_c); <span class="comment">% Estimate PDC and asymptotic statistics</span>
c.Tragct = Tr_gct;
c.pvaluesgct = pValue_gct;
</pre><h2 id="14">Plotting PDC original in Matrix Layout without asymptotic statistics</h2><pre class="codeinput"><span class="comment">%</span>
<span class="comment">% ---------------Plotting options flag setting-----------------------------</span>
<span class="comment">%             [1 2 3 4 5 6 7]</span>
flgPrinting = [1 0 0 0 3 0 1];
<span class="comment">%              | | | | | | 7 Spectra(0: w/o SS; 1: Linear; 2: log-scale)</span>
<span class="comment">%              | | | | | 6 Coherence</span>
<span class="comment">%              | | | | 5 Print GCT p-values</span>
<span class="comment">%              | | | 4 Plot upper confidence limit</span>
<span class="comment">%              | | 3 Significant PDC(w) in red line</span>
<span class="comment">%              | 2 Patnaik threshold level in black dashed-line</span>
<span class="comment">%              1 PDC in green line</span>
<span class="comment">%--------------------------------------------------------------------------</span>
flgColor = 0;
w_max=fs/2;
flgSignifColor = 0;
flgMax = <span class="string">'PDC'</span>;
flgScale = 2;

strBarTitle = <span class="string">'Andrews &amp; Herzberg''s Sunspot-Melanoma Series (1936-1972)'</span>;
strTitle = <span class="string">'Sunspot-Melanoma (1936-1972)'</span>;

[h1,~, ~] = xplot(strBarTitle,c,<span class="keyword">...</span>
                          flgPrinting,fs,w_max,chLabels,flgColor, <span class="keyword">...</span>
                          flgScale,flgMax,flgSignifColor);
xplot_title(alpha_c,metric,<span class="string">'pdc'</span>,strTitle);
shg; pause(3)
</pre><img vspace="5" hspace="5" src="andrews_herzberg_03.png" alt=""> <p>Note that, in this case, the original PDC from Melanoma (smaller variance) to Sunspot (larger variance) estimate is close to unit (large), but not significant, while in the opposite direction it is very small and significant. The p-values of Granger causality test result are printed above each PDC subplot in dark-green (not significant from Melanoma to Sunspot), or in dark-purple (significant from Sunspot to Melanoma series, together with a dot inside the subplot with the same color).</p><p>Proper "scaling" of original PDC estimates could be attained by standardizing the time series, i.e scaling to have unit variance and zero mean, or, better, using either generalized PDC or information PDC.</p><h2 id="16">Showing more detail by changing the scale and adding color information</h2><p>The following figure shows in more detail the rescaled y-axis of PDC from <b>Sunspot</b> to <b>Melanoma</b>, which one would expect some causal influence of solar radiation intensity increase on skin cancer incidence.</p><pre class="codeinput">flgScale = 2;
flgMax = <span class="string">'all'</span>;
flgSignifColor = 3;

[h2,hxlabel,hylabel] = xplot(strBarTitle,c,flgPrinting,fs,w_max,chLabels, <span class="keyword">...</span>
                          flgColor,flgScale,flgMax,flgSignifColor);
xplot_title(alpha_c,metric,<span class="string">'pdc'</span>,strTitle);
pause(3)
</pre><img vspace="5" hspace="5" src="andrews_herzberg_04.png" alt=""> <p>One interesting aspect of asymptotic statistics you may notice is that it gives proper and consistent inference for all three forms of PDC (PDC|gPDC|iPDC) and even for DTF (DTF|DC|iDTF).</p><p>The <b>robustness</b> is one of such interesting aspects of the analyses based on asymptotic statistics implemented in the AsympPDC Package.</p><h2 id="18">Generalized PDC estimation and analysis parameters</h2><p>The gPDC analysis results are saved in <b>d</b> struct variable, attained using metric = 'diag' (diagonal). See asymp_pdc.m help.</p><pre class="codeinput"> <span class="comment">% Estimate generalized PDC and its asymptotic statistics</span>
metric = <span class="string">'diag'</span>;
alpha_d = alpha_c;
d = asymp_pdc(u,A,pf,nFreqs,metric,alpha_d);

<span class="comment">% Assign GCT results to *d* struct variable</span>
d.Tragct = Tr_gct;
d.pvaluesgct = pValue_gct;
</pre><h2 id="19">Generalized PDC Matrix Layout Plotting</h2><pre class="codeinput">flgColor = 0;
[h3,hxlabel,hylabel] = xplot(strBarTitle,d,<span class="keyword">...</span>
                          flgPrinting,fs,w_max,chLabels,flgColor);
xplot_title(alpha_d,metric,<span class="string">'pdc'</span>,strTitle);
pause(3)
</pre><img vspace="5" hspace="5" src="andrews_herzberg_05.png" alt=""> <p>The <b>generalized PDC</b> provides a better idea  of real <i>interaction</i> between <b>Sunspot</b> number (an indirect measure of Sun's activity level) and incidence of <b>Melanoma</b> in the State of Connecticut.</p><p>Note that the peak of gPDC from Sunspot to Melanona in frequency coincides with the peak of Sunspot and Melanoma series power spectra, which corresponds to the 11-year Sun's activity cycle period.</p><h2 id="21">Repeating the analysis with Information PDC</h2><p>iPDC analysis results are saved in <b>e</b> struct variable.</p><pre class="codeinput"><span class="comment">% Estimate iPDC and asymptotic statistics</span>
metric = <span class="string">'info'</span>;
alpha_e = 0.01;
e = asymp_pdc(u,A,pf,nFreqs,metric,alpha_e);
e.Tragct = Tr_gct;
e.pvaluesgct = pValue_gct;
</pre><h2 id="22">iPDC with alpha = 1% analysis Matrix Layout Plotting</h2><pre class="codeinput">flgColor = 0;
flgPrinting=[1 1 1 3 3 1 1];
flgScale = 2;
flgMax = <span class="string">'all'</span>;
flgSignifColor = 3;

[h4,hxlabel,hylabel] = xplot(strBarTitle,e,flgPrinting,fs,w_max,chLabels, <span class="keyword">...</span>
                                       flgColor,flgScale,flgMax,flgSignifColor);
xplot_title(alpha_e,metric,<span class="string">'pdc'</span>,strTitle);
pause(3)
</pre><img vspace="5" hspace="5" src="andrews_herzberg_06.png" alt=""> <p>Looking closely, the iPDC and gPDC's magnitude patterns, although similar, are not equal.</p><h2 id="24">Plotting the PDC p-values in the frequency domain</h2><pre class="codeinput">flgPrinting=[1 1 1 2 3 1 1];
flgScale = 1;
strBarTitle = <span class="string">'Sunspot-Melanoma Series (1936-1972)'</span>; <span class="comment">% Trimmed to reveal p-values</span>

[h5,hxlabel,hylabel] = xplot_pvalues(strBarTitle, c, <span class="keyword">...</span>
                                  flgPrinting,fs,w_max,chLabels,flgColor,flgScale);
xplot_title(alpha_c,metric,<span class="string">'p-value iPDC'</span>,strTitle);
</pre><img vspace="5" hspace="5" src="andrews_herzberg_07.png" alt=""> <p>In this case <img src="andrews_herzberg_eq11007464405666851578.png" alt="$\alpha = 1$">% was used, and note the threshold dashed-lines located at -2 (<img src="andrews_herzberg_eq15528222941197467174.png" alt="$=log_{10}\,0.01$">). Only the iPDC from <b>Sunspot</b> to <b>Melanoma</b> is significant in the lower frequency range, which overlaps in the frequency scale with peaks of power spectra.</p><p>End of Sunspot-Melanoma series analysis example.</p><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% ANDREWS & HERZBERG (1985)a - Sunspot-Melanoma 1936-1972 Series PDC Demo
%
%% Data File: skin.dat
% This data is from:
%    D. F. Andrews, A. M. Herzberg. (1985) Data: A Collection of Problems from
%    Many Fields for the Student and Research Worker. Springer, New York.
%
% "The aetiology of melanoma is complex and may include the influences of
% trauma, heredity and hormonal activity. In particular, exposure to solar
% radiation may be involved in the pathogenesis of melanoma. Melanoma is more
% common in fair-skinned individuals and most frequent in skin sites exposed to
% the sun. In white populations melanoma is more common in areas closer to the
% equator where the intensity of solar radiation is higher. Data from various
% parts of the world suggest that the incidence of melanoma is increasing. The
% data below, giving age-adjusted melanoma incidence, are from the Connecticut
% Tumor Registry from 1936-1972. Connecticut has the longest record of state
% population-based cancer statistics in the United States of America. The data
% also includes the sunspot relative number. Houghton, Munster and Viola (1978)
% have shown that the age-adjusted incidence rate for malignant melanoma in the
% state of Connecticut has risen since 1935 and that superimposed on the rise
% are 3-5 year periods in which the rise in the rate of incidence is excessive.
% These periods have a cycle of 8-11 years and follow times of maximum sunspot
% activity. The relationship between solar cycles and melanoma supports the
% hypothesis that melanoma is related to sun exposure and provides evidence that
% solar radiation may trigger the development of clinically apparent melanoma.
% The columns are the year, male incidence, total incidence, and sunspot
% relative index. The incidence are rates per 100,000." (Andrews & Herzberg,
% 1985)
%
% Below is the contents of the file skin.dat:
%%
% * Year % 1936-1972
% * ANNUAL MALE MELANOMA INCIDENCE(AGE-ADJUSTED PER 10**5) CONNECTICUT
% * ANNUAL TOTAL MELANOMA INCIDENCE(AGE-ADJUSTED PER 10**5) CONNECTICUT
% * ANNUAL SUNSPOT RELATIVE NUMBER
%
%% Causality Analysis using Partial Directed Coherence (PDC) 
% In this example, ANNUAL SUNSPOT RELATIVE NUMBER and TOTAL MELANOMA
% INCIDENCE(AGE-ADJUSTED PER 10**5) in the state of CONNECTICUT will be
% considered
%
%% Additional References
%
% [0] Andrews, D.F., Herzberg, A.M. (1985). Incidence of Malignant Melanoma
%     After Peaks of Sunspot Activity. In: Data. Springer Series in Statistics.
%     Springer, New York, NY. <https://doi.org/10.1007/978-1-4612-5098-2_33>
% 
% [1] M.V. Viola, A. Houghton, E.W. Munster. Solar cycles and malignant melanoma.
%     Medical Hypotheses 5:153REPLACE_WITH_DASH_DASH160, 1979.
%       <https://doi.org/10.1016/0306-9877(79)90067-7>
%
% [2] A. Houghton, E.W. Munster and M.V. Viola. Increased incidence of
%     malignant melanoma after peaks of sunspot activity. The Lancet,
%     311:759REPLACE_WITH_DASH_DASH760, 1978.
%       <https://doi.org/10.1016/S0140-6736(78)90869-3>

% (C) Koichi Sameshima & Luiz A. Baccala, 2021. See file license.txt in
% installation directory for licensing terms.

clear; clc; format compact

format short
warning('off'); more off

disp(repmat('=',1,100))
disp('     Andrews and Herzberg''s Sunspot and Melanoma 1936-1972 Data');
disp('                 Sunspot REPLACE_WITH_DASH_DASH> Melanoma or other way?');
disp(repmat('=',1,100))

flgDataPlot = 1;

%% Retrieving data set for analysis from sunmeladat.m m-file
%

x=sunmeladat([4 3]); chLabels={'Sunspot';'Melanoma'};
u = x;
nPoints = length(u);

%% Plotting sunspot and melanoma series
%  
if flgDataPlot
   year=sunmeladat(1);  % Year variable
   h1=figure;
   set(h1,'NumberTitle','off','MenuBar','none', ...
      'Name','Andrews & Herzberg''s Sunspot-Melanoma Series (1936-1972)')
   
   h11 = subplot(311); plot(year,u(:,1),'o:r'); title('Sunspot series'); grid
   set(h11,'XLim', [1935 1975], 'XTick',[1935:5:1975], ...
                            'XTickLabel',[' ';' ';' ';' ';' ';' ';' ';' ';' ']);

   h12 = subplot(312); plot(year,u(:,2),'.:'); 
                     xlabel(''); 
                     title('Melanoma series');grid
   set(h12,'XLim', [1935 1975],'XTick',[1935:5:1975], ...
                            'XTickLabel',[' ';' ';' ';' ';' ';' ';' ';' ';' ']);
   
   h13 = subplot(313); plot(year,detrend(u(:,2)),'.:'); xlabel('year');
   set(h13,'XLim', [1935 1975])
   title('Detrended Melanoma series')
   grid; hold on;
   shg; pause(3)
   h2=figure;
   set(h2,'NumberTitle','off','MenuBar','none', ...
      'Name','Andrews & Herzberg''s Sunspot-Melanoma Series (1936-1972)')
   u2=u(:,2); u2=detrend(u2);

   h21 = subplot(211); plot(year,(u2-mean(u2))/std(u2),'b*:',...
      year,(u(:,1)-mean(u(:,1)))/std(u(:,1)),'ro:');
   xlabel('year');
   set(h21,'XLim', [1935 1975])
   title('Melanoma & Sunspot: Standardized series')
   legend('Melanoma','Sunspot');grid

   [uxcorr,lag] = xcorr(u2,u(:,1),'coeff');
   subplot(212); h22 = plot(lag,uxcorr,'o'); xlabel('lag(year)');
   title('Normalized cross-correlation function'); axis([-20 20 -1 1]);
   grid; hold on
   plot(2,uxcorr(39),'r.','MarkerSize',15) % Peak of cross-correlation.
   shg; pause(3)
end

%%
% Note the cross-correlation peak at 2-year time lag (filled circle).

%%
% Although for plotting purpose the Sunspot series was standardized, in the
% analyses that follow *the time series were not standardized*, and consequently
% the variance of Sunspot series is much larger than that of the Melanoma's
% series. This may give misleading high *Original PDC* values, although not
% significant, from *Melanoma to Sunspot*, as seen in the following analysis.


%% 
% Data pre-processing: detrending and standardization options


flgDetrend = 1;     % Detrending the data set
flgStandardize = 0; % No standardization
[nChannels,nSegLength] =size(u);
if nChannels > nSegLength, 
   u = u.'; 
   [nChannels,nSegLength]=size(u);
end
if flgDetrend
   for i=1:nChannels, u(i,:)=detrend(u(i,:)); end
   disp('Time series were detrended.');
end
if flgStandardize
   for i=1:nChannels, u(i,:)=u(i,:)/std(u(i,:)); end
   disp('Time series were scale-standardized.');
end

alpha_c = 0.01;
fs= 1; % Sampling frequency: 1 sample/year.

%% MVAR model estimation
%

maxIP = 4;         % maximum model order to consider.
alg = 1;            % 1: Nutall-Strand MVAR estimation algorithm;
%                   % 2: minimum least squares methods;
%                   % 3: Vieira Morf algorithm;
%                   % 4: QR ARfit algorith.

criterion = 1;      % Criterion for order choice:
%                   % 1: AIC, Akaike Information Criteria; 
%                   % 2: Hanna-Quinn;
%                   % 3: Schwarz;
%                   % 4: FPE;
%                   % 5: fixed order given by maxIP value.

disp('Running MVAR estimation routine...')
[IP,pf,A,pb,B,ef,eb,vaic,Vaicv] = mvar(u,maxIP,alg,criterion);
disp(['Number of channels = ' int2str(nChannels) ' with ' ...
    int2str(nSegLength) ' data points; MAR model order = ' int2str(IP) '.']);

%%
% Testing for adequacy of MAR model fitting through the Portmanteau test
h = 20; % testing lag
MVARadequacy_signif = 0.05; % VAR model estimation adequacy significance level
aValueMVAR = 1 - MVARadequacy_signif; % Confidence value for the testing
flgPrintResults = 1;                  % Print results in the Command Window
[Pass,Portmanteau,st,ths] = mvarresidue(ef,nSegLength,IP,aValueMVAR,h,...
                                           flgPrintResults);

%% Granger causality test (GCT) and instantaneous GCT
%

gct_signif  = 0.01;  % Granger causality test significance level
igct_signif = 0.01;  % Instantaneous GCT significance level
flgPrintResults = 1; % Flag to print gct_alg.m results on Command Window.
[Tr_gct, pValue_gct,]  = gct_alg(u,A,pf,gct_signif,flgPrintResults);
[Tr_igct, pValue_igct] = igct_alg(u,A,pf,igct_signif,flgPrintResults);

%% Original definition of PDC estimation
%
% PDC analysis results are saved in *c* struct variable.
% See *asymp_pdc.m* for more detail.

nFreqs = 128;
metric = 'euc';  % euc  = original PDC or DTF;
                 % diag = generalized PDC (gPDC) or DC;
                 % info = information PDC (iPDC) or iDTF.
alpha_c = 0.01;
c = asymp_pdc(u,A,pf,nFreqs,metric,alpha_c); % Estimate PDC and asymptotic statistics
c.Tragct = Tr_gct; 
c.pvaluesgct = pValue_gct;

%% Plotting PDC original in Matrix Layout without asymptotic statistics
%

% 
% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Plotting options flag settingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%             [1 2 3 4 5 6 7]
flgPrinting = [1 0 0 0 3 0 1];
%              | | | | | | 7 Spectra(0: w/o SS; 1: Linear; 2: log-scale)
%              | | | | | 6 Coherence
%              | | | | 5 Print GCT p-values
%              | | | 4 Plot upper confidence limit
%              | | 3 Significant PDC(w) in red line
%              | 2 Patnaik threshold level in black dashed-line
%              1 PDC in green line
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
flgColor = 0;
w_max=fs/2;
flgSignifColor = 0;
flgMax = 'PDC';
flgScale = 2;

strBarTitle = 'Andrews & Herzberg''s Sunspot-Melanoma Series (1936-1972)';
strTitle = 'Sunspot-Melanoma (1936-1972)';

[h1,~, ~] = xplot(strBarTitle,c,...
                          flgPrinting,fs,w_max,chLabels,flgColor, ...
                          flgScale,flgMax,flgSignifColor);
xplot_title(alpha_c,metric,'pdc',strTitle);
shg; pause(3)

%% 
% Note that, in this case, the original PDC from Melanoma (smaller variance) to
% Sunspot (larger variance) estimate is close to unit (large), but not
% significant, while in the opposite direction it is very small and significant.
% The p-values of Granger causality test result are printed above each PDC
% subplot in dark-green (not significant from Melanoma to Sunspot), or in
% dark-purple (significant from Sunspot to Melanoma series, together with a dot
% inside the subplot with the same color).
%
% Proper "scaling" of original PDC estimates could be attained by standardizing
% the time series, i.e scaling to have unit variance and zero mean, or, better,
% using either generalized PDC or information PDC.
%

%% Showing more detail by changing the scale and adding color information
% The following figure shows in more detail the rescaled y-axis of PDC from
% *Sunspot* to *Melanoma*, which one would expect some causal influence of solar
% radiation intensity increase on skin cancer incidence.

flgScale = 2;
flgMax = 'all';
flgSignifColor = 3;

[h2,hxlabel,hylabel] = xplot(strBarTitle,c,flgPrinting,fs,w_max,chLabels, ...
                          flgColor,flgScale,flgMax,flgSignifColor);
xplot_title(alpha_c,metric,'pdc',strTitle);
pause(3)

%%
% One interesting aspect of asymptotic statistics you may notice is that it
% gives proper and consistent inference for all three forms of PDC
% (PDC|gPDC|iPDC) and even for DTF (DTF|DC|iDTF).
%
% The *robustness* is one of such interesting aspects of the analyses based on
% asymptotic statistics implemented in the AsympPDC Package.

%% Generalized PDC estimation and analysis parameters
%
% The gPDC analysis results are saved in *d* struct variable, attained using
% metric = 'diag' (diagonal). See asymp_pdc.m help.

 % Estimate generalized PDC and its asymptotic statistics
metric = 'diag';
alpha_d = alpha_c;
d = asymp_pdc(u,A,pf,nFreqs,metric,alpha_d);

% Assign GCT results to *d* struct variable
d.Tragct = Tr_gct;         
d.pvaluesgct = pValue_gct;

%% Generalized PDC Matrix Layout Plotting
%

flgColor = 0;
[h3,hxlabel,hylabel] = xplot(strBarTitle,d,...
                          flgPrinting,fs,w_max,chLabels,flgColor);
xplot_title(alpha_d,metric,'pdc',strTitle);
pause(3)

%%
% The *generalized PDC* provides a better idea  of real _interaction_ between
% *Sunspot* number (an indirect measure of Sun's activity level) and incidence
% of *Melanoma* in the State of Connecticut.
%
% Note that the peak of gPDC from Sunspot to Melanona in frequency coincides
% with the peak of Sunspot and Melanoma series power spectra, which corresponds
% to the 11-year Sun's activity cycle period.


%% Repeating the analysis with Information PDC
%
% iPDC analysis results are saved in *e* struct variable.  
%

% Estimate iPDC and asymptotic statistics
metric = 'info';
alpha_e = 0.01;
e = asymp_pdc(u,A,pf,nFreqs,metric,alpha_e); 
e.Tragct = Tr_gct;
e.pvaluesgct = pValue_gct;

%% iPDC with alpha = 1% analysis Matrix Layout Plotting 
%

flgColor = 0;
flgPrinting=[1 1 1 3 3 1 1];
flgScale = 2;
flgMax = 'all';
flgSignifColor = 3;

[h4,hxlabel,hylabel] = xplot(strBarTitle,e,flgPrinting,fs,w_max,chLabels, ...
                                       flgColor,flgScale,flgMax,flgSignifColor);
xplot_title(alpha_e,metric,'pdc',strTitle);
pause(3)

%%
% Looking closely, the iPDC and gPDC's magnitude patterns, although similar, are
% not equal.

%% Plotting the PDC p-values in the frequency domain 
flgPrinting=[1 1 1 2 3 1 1];
flgScale = 1;
strBarTitle = 'Sunspot-Melanoma Series (1936-1972)'; % Trimmed to reveal p-values

[h5,hxlabel,hylabel] = xplot_pvalues(strBarTitle, c, ...
                                  flgPrinting,fs,w_max,chLabels,flgColor,flgScale);
xplot_title(alpha_c,metric,'p-value iPDC',strTitle);

%%
% In this case $\alpha = 1$% was used, and note the threshold dashed-lines
% located at -2 ($=log_{10}\,0.01$). Only the iPDC from *Sunspot* to
% *Melanoma* is significant in the lower frequency range, which overlaps in
% the frequency scale with peaks of power spectra.

%%
% End of Sunspot-Melanoma series analysis example.


##### SOURCE END #####
--></body></html>