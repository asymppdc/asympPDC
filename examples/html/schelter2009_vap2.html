
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>EICHLER ET AL.(2006)b - VAP II 5-dimension VAR[3] process</title><meta name="generator" content="MATLAB 9.8"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2022-10-26"><meta name="DC.source" content="schelter2009_vap2.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>EICHLER ET AL.(2006)b - VAP II 5-dimension VAR[3] process</h1><!--introduction--><p>An example borrowed from Schelter et al. (2009)</p><p>Schelter, Timmer, Eichler. Assessing the strength of directed influences among neural signals using renormalized PDC. J Neurosci Methods, 179:121-130, 2009.   [http://dx.doi.org/10.1016/j.jneumeth.2009.01.006]</p><p>3.2 Vector autoregressive process II (Eqs. 16-20, page 124)</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">See also: mvar, mvarresidue, asymp_pdc, asymp_dtf, gct_alg,</a></li><li><a href="#2">Equation Model II with feedback</a></li><li><a href="#3">Data generation</a></li><li><a href="#5">MVAR model estimation</a></li><li><a href="#6">Granger causality test (GCT) and instantaneous GCT</a></li><li><a href="#7">Information PDC estimation</a></li><li><a href="#8">iPDC2 Matrix-Layout Plot</a></li><li><a href="#9">Result from Schelter et al.(2009)</a></li><li><a href="#11">Remarks:</a></li></ul></div><h2 id="1">See also: mvar, mvarresidue, asymp_pdc, asymp_dtf, gct_alg,</h2><pre>            igct_alg, xplot, xplot_pvalues</pre><pre class="codeinput"><span class="comment">% (C) Koichi Sameshima &amp; Luiz A. Baccal&aacute;, 2022.</span>
<span class="comment">% See file license.txt in installation directory for licensing terms.</span>

clear; clc
</pre><h2 id="2">Equation Model II with feedback</h2><p>3.2 Vector autoregressive process II (Eqs. 16-20, page 124)</p><p><img vspace="5" hspace="5" src="fig_schelter2009_vap2_equations.png" alt=""> </p><h2 id="3">Data generation</h2><pre class="codeinput">nBurnIn = 10000;    <span class="comment">% number of points discarded at beginning of simulation</span>
nPoints  = 3000;   <span class="comment">% number of analyzed samples points</span>

u = fschelter2009_vap2(nPoints, nBurnIn);
<span class="comment">%chLabels = []; % or</span>
chLabels = {<span class="string">'x_1'</span>;<span class="string">'x_2'</span>;<span class="string">'x_3'</span>;<span class="string">'x_4'</span>;<span class="string">'x_5'</span>};
fs =1;
</pre><pre class="codeoutput">======================================================================
                    Five-dimensional VAR[2] process
              Schelter et al. J Neurosci Methods (2009).
                  x1--&gt;x2  x1--&gt;x5 x4--&gt;x3 x5--&gt;x3
======================================================================
</pre><p>Data pre-processing: detrending and normalization options</p><pre class="codeinput">flgDetrend = 1;     <span class="comment">% Detrending the data set</span>
flgStandardize = 0; <span class="comment">% No standardization</span>

[nChannels,nSegLength]=size(u);
<span class="keyword">if</span> nChannels &gt; nSegLength, u=u.';
   [nChannels,nSegLength]=size(u);
<span class="keyword">end</span>

<span class="keyword">if</span> flgDetrend
   <span class="keyword">for</span> i=1:nChannels, u(i,:)=detrend(u(i,:)); <span class="keyword">end</span>
   disp(<span class="string">'Time series were detrended.'</span>);
<span class="keyword">end</span>

<span class="keyword">if</span> flgStandardize
   <span class="keyword">for</span> i=1:nChannels, u(i,:)=u(i,:)/std(u(i,:)); <span class="keyword">end</span>
   disp(<span class="string">'Time series were scale-standardized.'</span>);
<span class="keyword">end</span>
</pre><pre class="codeoutput">Time series were detrended.
</pre><h2 id="5">MVAR model estimation</h2><pre class="codeinput">maxIP = 30;         <span class="comment">% maximum model order to consider.</span>
alg = 1;            <span class="comment">% 1: Nutall-Strand MVAR estimation algorithm;</span>
<span class="comment">%                   % 2: minimum least squares methods;</span>
<span class="comment">%                   % 3: Vieira Morf algorithm;</span>
<span class="comment">%                   % 4: QR ARfit algorith.</span>

criterion = 1;      <span class="comment">% Criterion for order choice:</span>
<span class="comment">%                   % 1: AIC, Akaike Information Criteria;</span>
<span class="comment">%                   % 2: Hanna-Quinn;</span>
<span class="comment">%                   % 3: Schwarz;</span>
<span class="comment">%                   % 4: FPE;</span>
<span class="comment">%                   % 5: fixed order given by maxIP value.</span>

disp(<span class="string">'Running MVAR estimation routine...'</span>)

[IP,pf,A,pb,B,ef,eb,vaic,Vaicv] = mvar(u,maxIP,alg,criterion);

disp([<span class="string">'Number of channels = '</span> int2str(nChannels) <span class="string">' with '</span> <span class="keyword">...</span>
    int2str(nSegLength) <span class="string">' data points; MAR model order = '</span> int2str(IP) <span class="string">'.'</span>]);

<span class="comment">%==========================================================================</span>
<span class="comment">%    Testing for adequacy of MAR model fitting through Portmanteau test</span>
<span class="comment">%==========================================================================</span>
h = 20; <span class="comment">% testing lag</span>
MVARadequacy_signif = 0.05; <span class="comment">% VAR model estimation adequacy significance</span>
                            <span class="comment">% level</span>
aValueMVAR = 1 - MVARadequacy_signif;
flgPrintResults = 1;
[Pass,Portmanteau,st,ths] = mvarresidue(ef,nSegLength,IP,aValueMVAR,h,<span class="keyword">...</span>
                                           flgPrintResults);
</pre><pre class="codeoutput">Running MVAR estimation routine...
maxOrder limited to 30
IP=1  vaic=135471.966933
IP=2  vaic=120280.387695
IP=3  vaic=120303.188141
 
Number of channels = 5 with 3000 data points; MAR model order = 2.

====================================================================================================
                  MVAR RESIDURES TEST FOR WHITENESS
----------------------------------------------------------------------------------------------------
Good MAR model fitting! Residues white noise hypothesis NOT rejected.
Pass = 0.024
  st = 429.363
</pre><h2 id="6">Granger causality test (GCT) and instantaneous GCT</h2><pre class="codeinput">gct_signif  = 0.05;  <span class="comment">% Granger causality test significance level</span>
igct_signif = 0.05;  <span class="comment">% Instantaneous GCT significance level</span>
flgPrintResults = 1; <span class="comment">% Flag to control printing gct_alg.m results on command window.</span>
[Tr_gct, pValue_gct] = gct_alg(u,A,pf,gct_signif,flgPrintResults);
[Tr_igct, pValue_igct] = igct_alg(u,A,pf,igct_signif,flgPrintResults);
</pre><pre class="codeoutput">
====================================================================================================
                         GRANGER CAUSALITY TEST
----------------------------------------------------------------------------------------------------
Connectivity matrix:
   NaN     0     0     0     0
     1   NaN     0     0     0
     0     0   NaN     1     1
     0     0     0   NaN     0
     1     0     0     0   NaN

Granger causality test p-values:
       NaN    0.7739    0.8980    0.2663    0.7996
         0       NaN    0.9882    0.9567    0.9778
    0.3972    0.7983       NaN         0         0
    0.9608    0.4347    0.9734       NaN    0.9205
         0    0.4025    0.7774    0.1899       NaN

====================================================================================================
                  INSTANTANEOUS GRANGER CAUSALITY TEST
----------------------------------------------------------------------------------------------------
Instantaneous connectivity matrix:
   NaN     0     0     0     0
     0   NaN     0     0     0
     0     0   NaN     0     0
     0     0     0   NaN     0
     0     0     0     0   NaN

Instantaneous Granger Causality test p-values:
       NaN    0.0721    0.5246    0.1187    0.1809
    0.0721       NaN    0.5389    0.9125    0.1653
    0.5246    0.5389       NaN    0.9633    0.5893
    0.1187    0.9125    0.9633       NaN    0.4080
    0.1809    0.1653    0.5893    0.4080       NaN

&gt;&gt;&gt;&gt; Instantaneous Granger Causality NOT detected.

====================================================================================================
</pre><h2 id="7">Information PDC estimation</h2><p>PDC analysis results are saved in <b>c</b> structure. See asymp_pdc.m or issue</p><pre class="language-matlab">&gt;&gt; help asymp_pdc
</pre><p>command for more detail.</p><pre class="codeinput">nFreqs = 128;
metric = <span class="string">'info'</span>;  <span class="comment">% euc  = original PDC or DTF;</span>
                 <span class="comment">% diag = generalized PDC (gPDC) or DC;</span>
                 <span class="comment">% info = information PDC (iPDC) or iDTF.</span>
alpha = 0.05;

c = asymp_pdc(u,A,pf,nFreqs,metric,alpha);
c.Tragct = Tr_gct;         <span class="comment">% Assigning GCT results to c struct variable.</span>
c.pvaluesgct = pValue_gct;
</pre><h2 id="8">iPDC2 Matrix-Layout Plot</h2><pre class="codeinput">flgPrinting = [1 1 1 2 3 0 2]; <span class="comment">% overriding default setting</span>
flgColor = 1;
w_max=fs/2;
alphastr = int2str(100*alpha);

strID = <span class="string">'Schelter et al. (2009)'</span>;
strTitle = [<span class="string">'Schelter et al. (2009) linear model II: '</span> <span class="keyword">...</span>
                               int2str(nPoints) <span class="string">' data points.'</span>];
[h,~,~] = xplot(strID,c,flgPrinting,fs,w_max,chLabels,flgColor,2,<span class="string">'pdc'</span>);
xplot_title(alpha,metric,<span class="string">'pdc'</span>,strTitle);
</pre><img vspace="5" hspace="5" src="schelter2009_vap2_01.png" alt=""> <h2 id="9">Result from Schelter et al.(2009)</h2><p>Figure 2, page 125.</p><p><img vspace="5" hspace="5" src="fig_schelter2009_vap2_result.png" alt=""> </p><p>Figure caption: "Fig 2. Renormalized partial directed coherence (off-diagonal) for the example of the VAR[2] process. The results are sorted as a matrix, where in the ith row and the jth column the influence from process j onto process i is displayed. The black line represents the renormalized partial directed coherence values while the gray areas mark the corresponding 95% confidence intervals of one single realization. From 1000 realizations empirical confidence intervals have been derived. These are indicated by the dashed black lines. Only the valid interactions are revealed by this analysis." (Reproduced from  Schelter et al. J Neurosci Methods, 179:121-130, 2009)</p><h2 id="11">Remarks:</h2><div><ul><li>Our <img src="schelter2009_vap2_eq16638434991807348760.png" alt="$|_iPDC(\lambda)|^2$"> results are from a single simulation data while normalized PDC are from 1000 simulations. Note that the y-axis scales for normalized PDC by Schelter et al. (2009) are different from iPDC2 plots.</li></ul></div><div><ul><li>Note again that for linear model the mean amplitude of PDC estimates is roughly proportional to  relative coefficient values of ') the autoregressive model.</li></ul></div><div><ul><li>One may see occasional false-positive inferences in iPDC estimates for <img src="schelter2009_vap2_eq04337108854082040212.png" alt="$\alpha = 5\%$">  null-hypothesis testing, however as one might notice the magnitude should most likely (from our experience) be smaller than 0.01 and Granger causality test p-values printed just above each subplot should be close to chosen <img src="schelter2009_vap2_eq14221827199139923399.png" alt="$\alpha$"> values.</li></ul></div><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% EICHLER ET AL.(2006)b - VAP II 5-dimension VAR[3] process
%
% An example borrowed from Schelter et al. (2009) 
%
% Schelter, Timmer, Eichler. Assessing the strength of directed influences
% among neural signals using renormalized PDC. J Neurosci Methods,
% 179:121-130, 2009.
%   [http://dx.doi.org/10.1016/j.jneumeth.2009.01.006]
% 
% 3.2 Vector autoregressive process II (Eqs. 16-20, page 124)
%
%% See also: mvar, mvarresidue, asymp_pdc, asymp_dtf, gct_alg, 
%              igct_alg, xplot, xplot_pvalues             

% (C) Koichi Sameshima & Luiz A. Baccalá, 2022. 
% See file license.txt in installation directory for licensing terms.

clear; clc

%% Equation Model II with feedback
% 3.2 Vector autoregressive process II (Eqs. 16-20, page 124)
%
% <<fig_schelter2009_vap2_equations.png>>
%


%% Data generation
%

nBurnIn = 10000;    % number of points discarded at beginning of simulation
nPoints  = 3000;   % number of analyzed samples points

u = fschelter2009_vap2(nPoints, nBurnIn);
%chLabels = []; % or 
chLabels = {'x_1';'x_2';'x_3';'x_4';'x_5'};
fs =1;

%%
% Data pre-processing: detrending and normalization options
flgDetrend = 1;     % Detrending the data set
flgStandardize = 0; % No standardization

[nChannels,nSegLength]=size(u);
if nChannels > nSegLength, u=u.'; 
   [nChannels,nSegLength]=size(u);
end

if flgDetrend
   for i=1:nChannels, u(i,:)=detrend(u(i,:)); end
   disp('Time series were detrended.');
end

if flgStandardize
   for i=1:nChannels, u(i,:)=u(i,:)/std(u(i,:)); end
   disp('Time series were scale-standardized.');
end

%% MVAR model estimation

maxIP = 30;         % maximum model order to consider.
alg = 1;            % 1: Nutall-Strand MVAR estimation algorithm;
%                   % 2: minimum least squares methods;
%                   % 3: Vieira Morf algorithm;
%                   % 4: QR ARfit algorith.

criterion = 1;      % Criterion for order choice:
%                   % 1: AIC, Akaike Information Criteria; 
%                   % 2: Hanna-Quinn;
%                   % 3: Schwarz;
%                   % 4: FPE;
%                   % 5: fixed order given by maxIP value.

disp('Running MVAR estimation routine...')

[IP,pf,A,pb,B,ef,eb,vaic,Vaicv] = mvar(u,maxIP,alg,criterion);

disp(['Number of channels = ' int2str(nChannels) ' with ' ...
    int2str(nSegLength) ' data points; MAR model order = ' int2str(IP) '.']);

%==========================================================================
%    Testing for adequacy of MAR model fitting through Portmanteau test
%==========================================================================
h = 20; % testing lag
MVARadequacy_signif = 0.05; % VAR model estimation adequacy significance
                            % level
aValueMVAR = 1 - MVARadequacy_signif;
flgPrintResults = 1;
[Pass,Portmanteau,st,ths] = mvarresidue(ef,nSegLength,IP,aValueMVAR,h,...
                                           flgPrintResults);

%% Granger causality test (GCT) and instantaneous GCT

gct_signif  = 0.05;  % Granger causality test significance level
igct_signif = 0.05;  % Instantaneous GCT significance level
flgPrintResults = 1; % Flag to control printing gct_alg.m results on command window.
[Tr_gct, pValue_gct] = gct_alg(u,A,pf,gct_signif,flgPrintResults);
[Tr_igct, pValue_igct] = igct_alg(u,A,pf,igct_signif,flgPrintResults);

%% Information PDC estimation
%
% PDC analysis results are saved in *c* structure.
% See asymp_pdc.m or issue 
%
%   >> help asymp_pdc 
%
% command for more detail.

nFreqs = 128;
metric = 'info';  % euc  = original PDC or DTF;
                 % diag = generalized PDC (gPDC) or DC;
                 % info = information PDC (iPDC) or iDTF.
alpha = 0.05;

c = asymp_pdc(u,A,pf,nFreqs,metric,alpha);
c.Tragct = Tr_gct;         % Assigning GCT results to c struct variable.
c.pvaluesgct = pValue_gct;

%% iPDC2 Matrix-Layout Plot

flgPrinting = [1 1 1 2 3 0 2]; % overriding default setting
flgColor = 1;
w_max=fs/2;
alphastr = int2str(100*alpha);

strID = 'Schelter et al. (2009)';
strTitle = ['Schelter et al. (2009) linear model II: ' ...
                               int2str(nPoints) ' data points.'];
[h,~,~] = xplot(strID,c,flgPrinting,fs,w_max,chLabels,flgColor,2,'pdc');
xplot_title(alpha,metric,'pdc',strTitle);


%% Result from Schelter et al.(2009) 
% Figure 2, page 125.
%
% <<fig_schelter2009_vap2_result.png>>
% 

%% 
% Figure caption: 
% "Fig 2. Renormalized partial directed coherence (off-diagonal) for the
% example of the VAR[2] process. The results are sorted as a matrix, where
% in the ith row and the jth column the influence from process j onto
% process i is displayed. The black line represents the renormalized
% partial directed coherence values while the gray areas mark the
% corresponding 95% confidence intervals of one single realization. From
% 1000 realizations empirical confidence intervals have been derived. These
% are indicated by the dashed black lines. Only the valid interactions are
% revealed by this analysis." (Reproduced from  Schelter et al. J Neurosci
% Methods, 179:121-130, 2009)

%% Remarks:
%
% * Our $|_iPDC(\lambda)|^2$ results are from a single simulation data
% while normalized PDC are from 1000 simulations. Note that the y-axis
% scales for normalized PDC by Schelter et al. (2009) are different from
% iPDC2 plots.
%
% * Note again that for linear model the mean amplitude of PDC estimates
% is roughly proportional to  relative coefficient values of ') the
% autoregressive model.
%
% * One may see occasional false-positive inferences in iPDC estimates for
% $\alpha = 5\%$  null-hypothesis testing, however as one might notice the
% magnitude should most likely (from our experience) be smaller than 0.01
% and Granger causality test p-values printed just above each subplot
% should be close to chosen $\alpha$ values.

##### SOURCE END #####
--></body></html>